{"version":3,"sources":["bundles/f0f51e0c471b5b038462/e2e-export.js","src/async-components/views/dialogs/ExportE2eKeysDialog.js","~/text-encoding-utf-8/lib/encoding.cjs.js","src/async-components/views/dialogs/ImportE2eKeysDialog.js","src/utils/MegolmExportEncryption.js","~/file-saver/FileSaver.js"],"names":["webpackJsonp","179","module","exports","__webpack_require__","_interopRequireWildcard","obj","__esModule","newObj","key","Object","prototype","hasOwnProperty","call","default","_interopRequireDefault","defineProperty","value","_stringify","_stringify2","_promise","_promise2","_fileSaver","_fileSaver2","_react","_react2","_languageHandler","_matrixJsSdk","Matrix","_MegolmExportEncryption","MegolmExportEncryption","_index","_index2","PHASE_EDIT","PHASE_EXPORTING","createClass","displayName","propTypes","matrixClient","PropTypes","instanceOf","MatrixClient","isRequired","onFinished","func","getInitialState","phase","errStr","componentWillMount","this","_unmounted","componentWillUnmount","_onPassphraseFormSubmit","ev","preventDefault","passphrase","refs","passphrase1","passphrase2","setState","_t","_startExport","_this","resolve","then","props","exportRoomKeys","k","encryptMegolmKeyFile","f","blob","Blob","type","saveAs","catch","e","console","error","msg","friendlyText","_onCancelClick","render","BaseDialog","getComponent","disableForm","state","createElement","className","title","onSubmit","htmlFor","ref","id","autoFocus","size","disabled","onClick","477","inRange","a","min","max","ToDictionary","o","undefined","TypeError","stringToCodePoints","string","s","String","n","length","i","u","c","charCodeAt","push","d","b","codePointsToString","code_points","cp","fromCharCode","Stream","tokens","slice","decoderError","fatal","opt_code_point","TextDecoder","encoding","options","toLowerCase","DEFAULT_ENCODING","Error","_streaming","_BOMseen","_decoder","_fatal","Boolean","_ignoreBOM","TextEncoder","_encoder","_options","UTF8Decoder","utf8_code_point","utf8_bytes_seen","utf8_bytes_needed","utf8_lower_boundary","utf8_upper_boundary","handler","stream","bite","end_of_stream","finished","prepend","code_point","UTF8Encoder","count","offset","bytes","temp","endOfStream","read","shift","token","Array","isArray","unshift","pop","decode","input","ArrayBuffer","Uint8Array","buffer","byteOffset","byteLength","result","input_stream","apply","indexOf","encode","opt_string","632","readFileAsArrayBuffer","file","reject","reader","FileReader","onload","target","onerror","readAsArrayBuffer","PHASE_IMPORTING","enableSubmit","_onFormChange","files","_onFormSubmit","_startImport","arrayBuffer","decryptMegolmKeyFile","keys","importRoomKeys","JSON","parse","onChange","647","friendlyError","cryptoFailMsg","unpackMegolmKeyFile","data","fileStr","lineStart","lineEnd","line","trim","HEADER_LINE","dataStart","TRAILER_LINE","dataEnd","decodeBase64","packMegolmKeyFile","LINE_LENGTH","nLines","Math","ceil","lines","encodeBase64","subarray","join","uint8Array","latin1String","window","btoa","base64","atob","_regenerator","_regenerator2","_slicedToArray2","_slicedToArray3","_bluebird","deriveKeys","_ref","coroutine","mark","_callee","password","body","version","ciphertextLength","salt","iv","iterations","ciphertext","hmac","_ref2","_ref3","aesKey","hmacKey","toVerify","isValid","plaintext","wrap","_context","prev","next","sent","subtleCrypto","verify","name","t0","decrypt","counter","t1","abrupt","stop","_x","_x2","arguments","_ref4","_callee2","kdfRounds","_ref5","_ref6","encodedData","cipherArray","bodyLength","resultBuffer","idx","toSign","hmacArray","_context2","kdf_rounds","crypto","getRandomValues","encrypt","set","sign","_x3","_x4","_x5","_ref7","_callee3","start","keybits","now","aesProm","hmacProm","_context3","Date","importKey","deriveBits","hash","log","all","_x6","_x7","_x8","_textEncodingUtf","TextEncodingUtf8","subtle","webkitSubtle","1173","__WEBPACK_AMD_DEFINE_RESULT__","view","navigator","test","userAgent","doc","document","get_URL","URL","webkitURL","save_link","createElementNS","can_use_save_link","click","node","event","MouseEvent","dispatchEvent","is_safari","HTMLElement","safari","is_chrome_ios","throw_outside","ex","setImmediate","setTimeout","force_saveable_type","arbitrary_revoke_timeout","revoke","revoker","revokeObjectURL","remove","dispatch","filesaver","event_types","concat","listener","auto_bom","FileSaver","no_auto_bom","object_url","force","dispatch_all","split","fs_error","onloadend","url","replace","popup","open","location","href","readyState","DONE","readAsDataURL","INIT","createObjectURL","opened","download","FS_proto","msSaveOrOpenBlob","abort","WRITING","onwritestart","onprogress","onwrite","onabort","onwriteend","self","content"],"mappings":"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","file":"bundles/f0f51e0c471b5b038462/e2e-export.js","sourcesContent":["webpackJsonp([0],{\n\n/***/ 179:\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _stringify = __webpack_require__(24);\n\t\n\tvar _stringify2 = _interopRequireDefault(_stringify);\n\t\n\tvar _promise = __webpack_require__(129);\n\t\n\tvar _promise2 = _interopRequireDefault(_promise);\n\t\n\tvar _fileSaver = __webpack_require__(1173);\n\t\n\tvar _fileSaver2 = _interopRequireDefault(_fileSaver);\n\t\n\tvar _react = __webpack_require__(1);\n\t\n\tvar _react2 = _interopRequireDefault(_react);\n\t\n\tvar _languageHandler = __webpack_require__(2);\n\t\n\tvar _matrixJsSdk = __webpack_require__(30);\n\t\n\tvar Matrix = _interopRequireWildcard(_matrixJsSdk);\n\t\n\tvar _MegolmExportEncryption = __webpack_require__(647);\n\t\n\tvar MegolmExportEncryption = _interopRequireWildcard(_MegolmExportEncryption);\n\t\n\tvar _index = __webpack_require__(3);\n\t\n\tvar _index2 = _interopRequireDefault(_index);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/*\n\tCopyright 2017 Vector Creations Ltd\n\t\n\tLicensed under the Apache License, Version 2.0 (the \"License\");\n\tyou may not use this file except in compliance with the License.\n\tYou may obtain a copy of the License at\n\t\n\t    http://www.apache.org/licenses/LICENSE-2.0\n\t\n\tUnless required by applicable law or agreed to in writing, software\n\tdistributed under the License is distributed on an \"AS IS\" BASIS,\n\tWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n\tSee the License for the specific language governing permissions and\n\tlimitations under the License.\n\t*/\n\t\n\tvar PHASE_EDIT = 1;\n\tvar PHASE_EXPORTING = 2;\n\t\n\texports.default = _react2.default.createClass({\n\t    displayName: 'ExportE2eKeysDialog',\n\t\n\t    propTypes: {\n\t        matrixClient: _react2.default.PropTypes.instanceOf(Matrix.MatrixClient).isRequired,\n\t        onFinished: _react2.default.PropTypes.func.isRequired\n\t    },\n\t\n\t    getInitialState: function getInitialState() {\n\t        return {\n\t            phase: PHASE_EDIT,\n\t            errStr: null\n\t        };\n\t    },\n\t\n\t    componentWillMount: function componentWillMount() {\n\t        this._unmounted = false;\n\t    },\n\t\n\t    componentWillUnmount: function componentWillUnmount() {\n\t        this._unmounted = true;\n\t    },\n\t\n\t    _onPassphraseFormSubmit: function _onPassphraseFormSubmit(ev) {\n\t        ev.preventDefault();\n\t\n\t        var passphrase = this.refs.passphrase1.value;\n\t        if (passphrase !== this.refs.passphrase2.value) {\n\t            this.setState({ errStr: (0, _languageHandler._t)('Passphrases must match') });\n\t            return false;\n\t        }\n\t        if (!passphrase) {\n\t            this.setState({ errStr: (0, _languageHandler._t)('Passphrase must not be empty') });\n\t            return false;\n\t        }\n\t\n\t        this._startExport(passphrase);\n\t        return false;\n\t    },\n\t\n\t    _startExport: function _startExport(passphrase) {\n\t        var _this = this;\n\t\n\t        // extra Promise.resolve() to turn synchronous exceptions into\n\t        // asynchronous ones.\n\t        _promise2.default.resolve().then(function () {\n\t            return _this.props.matrixClient.exportRoomKeys();\n\t        }).then(function (k) {\n\t            return MegolmExportEncryption.encryptMegolmKeyFile((0, _stringify2.default)(k), passphrase);\n\t        }).then(function (f) {\n\t            var blob = new Blob([f], {\n\t                type: 'text/plain;charset=us-ascii'\n\t            });\n\t            _fileSaver2.default.saveAs(blob, 'riot-keys.txt');\n\t            _this.props.onFinished(true);\n\t        }).catch(function (e) {\n\t            console.error(\"Error exporting e2e keys:\", e);\n\t            if (_this._unmounted) {\n\t                return;\n\t            }\n\t            var msg = e.friendlyText || (0, _languageHandler._t)('Unknown error');\n\t            _this.setState({\n\t                errStr: msg,\n\t                phase: PHASE_EDIT\n\t            });\n\t        });\n\t\n\t        this.setState({\n\t            errStr: null,\n\t            phase: PHASE_EXPORTING\n\t        });\n\t    },\n\t\n\t    _onCancelClick: function _onCancelClick(ev) {\n\t        ev.preventDefault();\n\t        this.props.onFinished(false);\n\t        return false;\n\t    },\n\t\n\t    render: function render() {\n\t        var BaseDialog = _index2.default.getComponent('views.dialogs.BaseDialog');\n\t\n\t        var disableForm = this.state.phase === PHASE_EXPORTING;\n\t\n\t        return _react2.default.createElement(\n\t            BaseDialog,\n\t            { className: 'mx_exportE2eKeysDialog',\n\t                onFinished: this.props.onFinished,\n\t                title: (0, _languageHandler._t)(\"Export room keys\")\n\t            },\n\t            _react2.default.createElement(\n\t                'form',\n\t                { onSubmit: this._onPassphraseFormSubmit },\n\t                _react2.default.createElement(\n\t                    'div',\n\t                    { className: 'mx_Dialog_content' },\n\t                    _react2.default.createElement(\n\t                        'p',\n\t                        null,\n\t                        (0, _languageHandler._t)('This process allows you to export the keys for messages ' + 'you have received in encrypted rooms to a local file. You ' + 'will then be able to import the file into another Matrix ' + 'client in the future, so that client will also be able to ' + 'decrypt these messages.')\n\t                    ),\n\t                    _react2.default.createElement(\n\t                        'p',\n\t                        null,\n\t                        (0, _languageHandler._t)('The exported file will allow anyone who can read it to decrypt ' + 'any encrypted messages that you can see, so you should be ' + 'careful to keep it secure. To help with this, you should enter ' + 'a passphrase below, which will be used to encrypt the exported ' + 'data. It will only be possible to import the data by using the ' + 'same passphrase.')\n\t                    ),\n\t                    _react2.default.createElement(\n\t                        'div',\n\t                        { className: 'error' },\n\t                        this.state.errStr\n\t                    ),\n\t                    _react2.default.createElement(\n\t                        'div',\n\t                        { className: 'mx_E2eKeysDialog_inputTable' },\n\t                        _react2.default.createElement(\n\t                            'div',\n\t                            { className: 'mx_E2eKeysDialog_inputRow' },\n\t                            _react2.default.createElement(\n\t                                'div',\n\t                                { className: 'mx_E2eKeysDialog_inputLabel' },\n\t                                _react2.default.createElement(\n\t                                    'label',\n\t                                    { htmlFor: 'passphrase1' },\n\t                                    (0, _languageHandler._t)(\"Enter passphrase\")\n\t                                )\n\t                            ),\n\t                            _react2.default.createElement(\n\t                                'div',\n\t                                { className: 'mx_E2eKeysDialog_inputCell' },\n\t                                _react2.default.createElement('input', { ref: 'passphrase1', id: 'passphrase1',\n\t                                    autoFocus: true, size: '64', type: 'password',\n\t                                    disabled: disableForm\n\t                                })\n\t                            )\n\t                        ),\n\t                        _react2.default.createElement(\n\t                            'div',\n\t                            { className: 'mx_E2eKeysDialog_inputRow' },\n\t                            _react2.default.createElement(\n\t                                'div',\n\t                                { className: 'mx_E2eKeysDialog_inputLabel' },\n\t                                _react2.default.createElement(\n\t                                    'label',\n\t                                    { htmlFor: 'passphrase2' },\n\t                                    (0, _languageHandler._t)(\"Confirm passphrase\")\n\t                                )\n\t                            ),\n\t                            _react2.default.createElement(\n\t                                'div',\n\t                                { className: 'mx_E2eKeysDialog_inputCell' },\n\t                                _react2.default.createElement('input', { ref: 'passphrase2', id: 'passphrase2',\n\t                                    size: '64', type: 'password',\n\t                                    disabled: disableForm\n\t                                })\n\t                            )\n\t                        )\n\t                    )\n\t                ),\n\t                _react2.default.createElement(\n\t                    'div',\n\t                    { className: 'mx_Dialog_buttons' },\n\t                    _react2.default.createElement('input', { className: 'mx_Dialog_primary', type: 'submit', value: (0, _languageHandler._t)('Export'),\n\t                        disabled: disableForm\n\t                    }),\n\t                    _react2.default.createElement(\n\t                        'button',\n\t                        { onClick: this._onCancelClick, disabled: disableForm },\n\t                        (0, _languageHandler._t)(\"Cancel\")\n\t                    )\n\t                )\n\t            )\n\t        );\n\t    }\n\t});\n\tmodule.exports = exports['default'];\n\n\n/***/ }),\n\n/***/ 477:\n/***/ (function(module, exports) {\n\n\t'use strict';\n\t\n\t// This is free and unencumbered software released into the public domain.\n\t// See LICENSE.md for more information.\n\t\n\t//\n\t// Utilities\n\t//\n\t\n\t/**\n\t * @param {number} a The number to test.\n\t * @param {number} min The minimum value in the range, inclusive.\n\t * @param {number} max The maximum value in the range, inclusive.\n\t * @return {boolean} True if a >= min and a <= max.\n\t */\n\tfunction inRange(a, min, max) {\n\t  return min <= a && a <= max;\n\t}\n\t\n\t/**\n\t * @param {*} o\n\t * @return {Object}\n\t */\n\tfunction ToDictionary(o) {\n\t  if (o === undefined) return {};\n\t  if (o === Object(o)) return o;\n\t  throw TypeError('Could not convert argument to dictionary');\n\t}\n\t\n\t/**\n\t * @param {string} string Input string of UTF-16 code units.\n\t * @return {!Array.<number>} Code points.\n\t */\n\tfunction stringToCodePoints(string) {\n\t  // https://heycam.github.io/webidl/#dfn-obtain-unicode\n\t\n\t  // 1. Let S be the DOMString value.\n\t  var s = String(string);\n\t\n\t  // 2. Let n be the length of S.\n\t  var n = s.length;\n\t\n\t  // 3. Initialize i to 0.\n\t  var i = 0;\n\t\n\t  // 4. Initialize U to be an empty sequence of Unicode characters.\n\t  var u = [];\n\t\n\t  // 5. While i < n:\n\t  while (i < n) {\n\t\n\t    // 1. Let c be the code unit in S at index i.\n\t    var c = s.charCodeAt(i);\n\t\n\t    // 2. Depending on the value of c:\n\t\n\t    // c < 0xD800 or c > 0xDFFF\n\t    if (c < 0xD800 || c > 0xDFFF) {\n\t      // Append to U the Unicode character with code point c.\n\t      u.push(c);\n\t    }\n\t\n\t    // 0xDC00 ≤ c ≤ 0xDFFF\n\t    else if (0xDC00 <= c && c <= 0xDFFF) {\n\t      // Append to U a U+FFFD REPLACEMENT CHARACTER.\n\t      u.push(0xFFFD);\n\t    }\n\t\n\t    // 0xD800 ≤ c ≤ 0xDBFF\n\t    else if (0xD800 <= c && c <= 0xDBFF) {\n\t      // 1. If i = n−1, then append to U a U+FFFD REPLACEMENT\n\t      // CHARACTER.\n\t      if (i === n - 1) {\n\t        u.push(0xFFFD);\n\t      }\n\t      // 2. Otherwise, i < n−1:\n\t      else {\n\t        // 1. Let d be the code unit in S at index i+1.\n\t        var d = string.charCodeAt(i + 1);\n\t\n\t        // 2. If 0xDC00 ≤ d ≤ 0xDFFF, then:\n\t        if (0xDC00 <= d && d <= 0xDFFF) {\n\t          // 1. Let a be c & 0x3FF.\n\t          var a = c & 0x3FF;\n\t\n\t          // 2. Let b be d & 0x3FF.\n\t          var b = d & 0x3FF;\n\t\n\t          // 3. Append to U the Unicode character with code point\n\t          // 2^16+2^10*a+b.\n\t          u.push(0x10000 + (a << 10) + b);\n\t\n\t          // 4. Set i to i+1.\n\t          i += 1;\n\t        }\n\t\n\t        // 3. Otherwise, d < 0xDC00 or d > 0xDFFF. Append to U a\n\t        // U+FFFD REPLACEMENT CHARACTER.\n\t        else  {\n\t          u.push(0xFFFD);\n\t        }\n\t      }\n\t    }\n\t\n\t    // 3. Set i to i+1.\n\t    i += 1;\n\t  }\n\t\n\t  // 6. Return U.\n\t  return u;\n\t}\n\t\n\t/**\n\t * @param {!Array.<number>} code_points Array of code points.\n\t * @return {string} string String of UTF-16 code units.\n\t */\n\tfunction codePointsToString(code_points) {\n\t  var s = '';\n\t  for (var i = 0; i < code_points.length; ++i) {\n\t    var cp = code_points[i];\n\t    if (cp <= 0xFFFF) {\n\t      s += String.fromCharCode(cp);\n\t    } else {\n\t      cp -= 0x10000;\n\t      s += String.fromCharCode((cp >> 10) + 0xD800,\n\t                               (cp & 0x3FF) + 0xDC00);\n\t    }\n\t  }\n\t  return s;\n\t}\n\t\n\t\n\t//\n\t// Implementation of Encoding specification\n\t// https://encoding.spec.whatwg.org/\n\t//\n\t\n\t//\n\t// 3. Terminology\n\t//\n\t\n\t/**\n\t * End-of-stream is a special token that signifies no more tokens\n\t * are in the stream.\n\t * @const\n\t */ var end_of_stream = -1;\n\t\n\t/**\n\t * A stream represents an ordered sequence of tokens.\n\t *\n\t * @constructor\n\t * @param {!(Array.<number>|Uint8Array)} tokens Array of tokens that provide the\n\t * stream.\n\t */\n\tfunction Stream(tokens) {\n\t  /** @type {!Array.<number>} */\n\t  this.tokens = [].slice.call(tokens);\n\t}\n\t\n\tStream.prototype = {\n\t  /**\n\t   * @return {boolean} True if end-of-stream has been hit.\n\t   */\n\t  endOfStream: function() {\n\t    return !this.tokens.length;\n\t  },\n\t\n\t  /**\n\t   * When a token is read from a stream, the first token in the\n\t   * stream must be returned and subsequently removed, and\n\t   * end-of-stream must be returned otherwise.\n\t   *\n\t   * @return {number} Get the next token from the stream, or\n\t   * end_of_stream.\n\t   */\n\t   read: function() {\n\t    if (!this.tokens.length)\n\t      return end_of_stream;\n\t     return this.tokens.shift();\n\t   },\n\t\n\t  /**\n\t   * When one or more tokens are prepended to a stream, those tokens\n\t   * must be inserted, in given order, before the first token in the\n\t   * stream.\n\t   *\n\t   * @param {(number|!Array.<number>)} token The token(s) to prepend to the stream.\n\t   */\n\t  prepend: function(token) {\n\t    if (Array.isArray(token)) {\n\t      var tokens = /**@type {!Array.<number>}*/(token);\n\t      while (tokens.length)\n\t        this.tokens.unshift(tokens.pop());\n\t    } else {\n\t      this.tokens.unshift(token);\n\t    }\n\t  },\n\t\n\t  /**\n\t   * When one or more tokens are pushed to a stream, those tokens\n\t   * must be inserted, in given order, after the last token in the\n\t   * stream.\n\t   *\n\t   * @param {(number|!Array.<number>)} token The tokens(s) to prepend to the stream.\n\t   */\n\t  push: function(token) {\n\t    if (Array.isArray(token)) {\n\t      var tokens = /**@type {!Array.<number>}*/(token);\n\t      while (tokens.length)\n\t        this.tokens.push(tokens.shift());\n\t    } else {\n\t      this.tokens.push(token);\n\t    }\n\t  }\n\t};\n\t\n\t//\n\t// 4. Encodings\n\t//\n\t\n\t// 4.1 Encoders and decoders\n\t\n\t/** @const */\n\tvar finished = -1;\n\t\n\t/**\n\t * @param {boolean} fatal If true, decoding errors raise an exception.\n\t * @param {number=} opt_code_point Override the standard fallback code point.\n\t * @return {number} The code point to insert on a decoding error.\n\t */\n\tfunction decoderError(fatal, opt_code_point) {\n\t  if (fatal)\n\t    throw TypeError('Decoder error');\n\t  return opt_code_point || 0xFFFD;\n\t}\n\t\n\t//\n\t// 7. API\n\t//\n\t\n\t/** @const */ var DEFAULT_ENCODING = 'utf-8';\n\t\n\t// 7.1 Interface TextDecoder\n\t\n\t/**\n\t * @constructor\n\t * @param {string=} encoding The label of the encoding;\n\t *     defaults to 'utf-8'.\n\t * @param {Object=} options\n\t */\n\tfunction TextDecoder(encoding, options) {\n\t  if (!(this instanceof TextDecoder)) {\n\t    return new TextDecoder(encoding, options);\n\t  }\n\t  encoding = encoding !== undefined ? String(encoding).toLowerCase() : DEFAULT_ENCODING;\n\t  if (encoding !== DEFAULT_ENCODING) {\n\t    throw new Error('Encoding not supported. Only utf-8 is supported');\n\t  }\n\t  options = ToDictionary(options);\n\t\n\t  /** @private @type {boolean} */\n\t  this._streaming = false;\n\t  /** @private @type {boolean} */\n\t  this._BOMseen = false;\n\t  /** @private @type {?Decoder} */\n\t  this._decoder = null;\n\t  /** @private @type {boolean} */\n\t  this._fatal = Boolean(options['fatal']);\n\t  /** @private @type {boolean} */\n\t  this._ignoreBOM = Boolean(options['ignoreBOM']);\n\t\n\t  Object.defineProperty(this, 'encoding', {value: 'utf-8'});\n\t  Object.defineProperty(this, 'fatal', {value: this._fatal});\n\t  Object.defineProperty(this, 'ignoreBOM', {value: this._ignoreBOM});\n\t}\n\t\n\tTextDecoder.prototype = {\n\t  /**\n\t   * @param {ArrayBufferView=} input The buffer of bytes to decode.\n\t   * @param {Object=} options\n\t   * @return {string} The decoded string.\n\t   */\n\t  decode: function decode(input, options) {\n\t    var bytes;\n\t    if (typeof input === 'object' && input instanceof ArrayBuffer) {\n\t      bytes = new Uint8Array(input);\n\t    } else if (typeof input === 'object' && 'buffer' in input &&\n\t               input.buffer instanceof ArrayBuffer) {\n\t      bytes = new Uint8Array(input.buffer,\n\t                             input.byteOffset,\n\t                             input.byteLength);\n\t    } else {\n\t      bytes = new Uint8Array(0);\n\t    }\n\t\n\t    options = ToDictionary(options);\n\t\n\t    if (!this._streaming) {\n\t      this._decoder = new UTF8Decoder({fatal: this._fatal});\n\t      this._BOMseen = false;\n\t    }\n\t    this._streaming = Boolean(options['stream']);\n\t\n\t    var input_stream = new Stream(bytes);\n\t\n\t    var code_points = [];\n\t\n\t    /** @type {?(number|!Array.<number>)} */\n\t    var result;\n\t\n\t    while (!input_stream.endOfStream()) {\n\t      result = this._decoder.handler(input_stream, input_stream.read());\n\t      if (result === finished)\n\t        break;\n\t      if (result === null)\n\t        continue;\n\t      if (Array.isArray(result))\n\t        code_points.push.apply(code_points, /**@type {!Array.<number>}*/(result));\n\t      else\n\t        code_points.push(result);\n\t    }\n\t    if (!this._streaming) {\n\t      do {\n\t        result = this._decoder.handler(input_stream, input_stream.read());\n\t        if (result === finished)\n\t          break;\n\t        if (result === null)\n\t          continue;\n\t        if (Array.isArray(result))\n\t          code_points.push.apply(code_points, /**@type {!Array.<number>}*/(result));\n\t        else\n\t          code_points.push(result);\n\t      } while (!input_stream.endOfStream());\n\t      this._decoder = null;\n\t    }\n\t\n\t    if (code_points.length) {\n\t      // If encoding is one of utf-8, utf-16be, and utf-16le, and\n\t      // ignore BOM flag and BOM seen flag are unset, run these\n\t      // subsubsteps:\n\t      if (['utf-8'].indexOf(this.encoding) !== -1 &&\n\t          !this._ignoreBOM && !this._BOMseen) {\n\t        // If token is U+FEFF, set BOM seen flag.\n\t        if (code_points[0] === 0xFEFF) {\n\t          this._BOMseen = true;\n\t          code_points.shift();\n\t        } else {\n\t          // Otherwise, if token is not end-of-stream, set BOM seen\n\t          // flag and append token to output.\n\t          this._BOMseen = true;\n\t        }\n\t      }\n\t    }\n\t\n\t    return codePointsToString(code_points);\n\t  }\n\t};\n\t\n\t// 7.2 Interface TextEncoder\n\t\n\t/**\n\t * @constructor\n\t * @param {string=} encoding The label of the encoding;\n\t *     defaults to 'utf-8'.\n\t * @param {Object=} options\n\t */\n\tfunction TextEncoder(encoding, options) {\n\t  if (!(this instanceof TextEncoder))\n\t    return new TextEncoder(encoding, options);\n\t  encoding = encoding !== undefined ? String(encoding).toLowerCase() : DEFAULT_ENCODING;\n\t  if (encoding !== DEFAULT_ENCODING) {\n\t    throw new Error('Encoding not supported. Only utf-8 is supported');\n\t  }\n\t  options = ToDictionary(options);\n\t\n\t  /** @private @type {boolean} */\n\t  this._streaming = false;\n\t  /** @private @type {?Encoder} */\n\t  this._encoder = null;\n\t  /** @private @type {{fatal: boolean}} */\n\t  this._options = {fatal: Boolean(options['fatal'])};\n\t\n\t  Object.defineProperty(this, 'encoding', {value: 'utf-8'});\n\t}\n\t\n\tTextEncoder.prototype = {\n\t  /**\n\t   * @param {string=} opt_string The string to encode.\n\t   * @param {Object=} options\n\t   * @return {Uint8Array} Encoded bytes, as a Uint8Array.\n\t   */\n\t  encode: function encode(opt_string, options) {\n\t    opt_string = opt_string ? String(opt_string) : '';\n\t    options = ToDictionary(options);\n\t\n\t    // NOTE: This option is nonstandard. None of the encodings\n\t    // permitted for encoding (i.e. UTF-8, UTF-16) are stateful,\n\t    // so streaming is not necessary.\n\t    if (!this._streaming)\n\t      this._encoder = new UTF8Encoder(this._options);\n\t    this._streaming = Boolean(options['stream']);\n\t\n\t    var bytes = [];\n\t    var input_stream = new Stream(stringToCodePoints(opt_string));\n\t    /** @type {?(number|!Array.<number>)} */\n\t    var result;\n\t    while (!input_stream.endOfStream()) {\n\t      result = this._encoder.handler(input_stream, input_stream.read());\n\t      if (result === finished)\n\t        break;\n\t      if (Array.isArray(result))\n\t        bytes.push.apply(bytes, /**@type {!Array.<number>}*/(result));\n\t      else\n\t        bytes.push(result);\n\t    }\n\t    if (!this._streaming) {\n\t      while (true) {\n\t        result = this._encoder.handler(input_stream, input_stream.read());\n\t        if (result === finished)\n\t          break;\n\t        if (Array.isArray(result))\n\t          bytes.push.apply(bytes, /**@type {!Array.<number>}*/(result));\n\t        else\n\t          bytes.push(result);\n\t      }\n\t      this._encoder = null;\n\t    }\n\t    return new Uint8Array(bytes);\n\t  }\n\t};\n\t\n\t//\n\t// 8. The encoding\n\t//\n\t\n\t// 8.1 utf-8\n\t\n\t/**\n\t * @constructor\n\t * @implements {Decoder}\n\t * @param {{fatal: boolean}} options\n\t */\n\tfunction UTF8Decoder(options) {\n\t  var fatal = options.fatal;\n\t\n\t  // utf-8's decoder's has an associated utf-8 code point, utf-8\n\t  // bytes seen, and utf-8 bytes needed (all initially 0), a utf-8\n\t  // lower boundary (initially 0x80), and a utf-8 upper boundary\n\t  // (initially 0xBF).\n\t  var /** @type {number} */ utf8_code_point = 0,\n\t      /** @type {number} */ utf8_bytes_seen = 0,\n\t      /** @type {number} */ utf8_bytes_needed = 0,\n\t      /** @type {number} */ utf8_lower_boundary = 0x80,\n\t      /** @type {number} */ utf8_upper_boundary = 0xBF;\n\t\n\t  /**\n\t   * @param {Stream} stream The stream of bytes being decoded.\n\t   * @param {number} bite The next byte read from the stream.\n\t   * @return {?(number|!Array.<number>)} The next code point(s)\n\t   *     decoded, or null if not enough data exists in the input\n\t   *     stream to decode a complete code point.\n\t   */\n\t  this.handler = function(stream, bite) {\n\t    // 1. If byte is end-of-stream and utf-8 bytes needed is not 0,\n\t    // set utf-8 bytes needed to 0 and return error.\n\t    if (bite === end_of_stream && utf8_bytes_needed !== 0) {\n\t      utf8_bytes_needed = 0;\n\t      return decoderError(fatal);\n\t    }\n\t\n\t    // 2. If byte is end-of-stream, return finished.\n\t    if (bite === end_of_stream)\n\t      return finished;\n\t\n\t    // 3. If utf-8 bytes needed is 0, based on byte:\n\t    if (utf8_bytes_needed === 0) {\n\t\n\t      // 0x00 to 0x7F\n\t      if (inRange(bite, 0x00, 0x7F)) {\n\t        // Return a code point whose value is byte.\n\t        return bite;\n\t      }\n\t\n\t      // 0xC2 to 0xDF\n\t      if (inRange(bite, 0xC2, 0xDF)) {\n\t        // Set utf-8 bytes needed to 1 and utf-8 code point to byte\n\t        // − 0xC0.\n\t        utf8_bytes_needed = 1;\n\t        utf8_code_point = bite - 0xC0;\n\t      }\n\t\n\t      // 0xE0 to 0xEF\n\t      else if (inRange(bite, 0xE0, 0xEF)) {\n\t        // 1. If byte is 0xE0, set utf-8 lower boundary to 0xA0.\n\t        if (bite === 0xE0)\n\t          utf8_lower_boundary = 0xA0;\n\t        // 2. If byte is 0xED, set utf-8 upper boundary to 0x9F.\n\t        if (bite === 0xED)\n\t          utf8_upper_boundary = 0x9F;\n\t        // 3. Set utf-8 bytes needed to 2 and utf-8 code point to\n\t        // byte − 0xE0.\n\t        utf8_bytes_needed = 2;\n\t        utf8_code_point = bite - 0xE0;\n\t      }\n\t\n\t      // 0xF0 to 0xF4\n\t      else if (inRange(bite, 0xF0, 0xF4)) {\n\t        // 1. If byte is 0xF0, set utf-8 lower boundary to 0x90.\n\t        if (bite === 0xF0)\n\t          utf8_lower_boundary = 0x90;\n\t        // 2. If byte is 0xF4, set utf-8 upper boundary to 0x8F.\n\t        if (bite === 0xF4)\n\t          utf8_upper_boundary = 0x8F;\n\t        // 3. Set utf-8 bytes needed to 3 and utf-8 code point to\n\t        // byte − 0xF0.\n\t        utf8_bytes_needed = 3;\n\t        utf8_code_point = bite - 0xF0;\n\t      }\n\t\n\t      // Otherwise\n\t      else {\n\t        // Return error.\n\t        return decoderError(fatal);\n\t      }\n\t\n\t      // Then (byte is in the range 0xC2 to 0xF4) set utf-8 code\n\t      // point to utf-8 code point << (6 × utf-8 bytes needed) and\n\t      // return continue.\n\t      utf8_code_point = utf8_code_point << (6 * utf8_bytes_needed);\n\t      return null;\n\t    }\n\t\n\t    // 4. If byte is not in the range utf-8 lower boundary to utf-8\n\t    // upper boundary, run these substeps:\n\t    if (!inRange(bite, utf8_lower_boundary, utf8_upper_boundary)) {\n\t\n\t      // 1. Set utf-8 code point, utf-8 bytes needed, and utf-8\n\t      // bytes seen to 0, set utf-8 lower boundary to 0x80, and set\n\t      // utf-8 upper boundary to 0xBF.\n\t      utf8_code_point = utf8_bytes_needed = utf8_bytes_seen = 0;\n\t      utf8_lower_boundary = 0x80;\n\t      utf8_upper_boundary = 0xBF;\n\t\n\t      // 2. Prepend byte to stream.\n\t      stream.prepend(bite);\n\t\n\t      // 3. Return error.\n\t      return decoderError(fatal);\n\t    }\n\t\n\t    // 5. Set utf-8 lower boundary to 0x80 and utf-8 upper boundary\n\t    // to 0xBF.\n\t    utf8_lower_boundary = 0x80;\n\t    utf8_upper_boundary = 0xBF;\n\t\n\t    // 6. Increase utf-8 bytes seen by one and set utf-8 code point\n\t    // to utf-8 code point + (byte − 0x80) << (6 × (utf-8 bytes\n\t    // needed − utf-8 bytes seen)).\n\t    utf8_bytes_seen += 1;\n\t    utf8_code_point += (bite - 0x80) << (6 * (utf8_bytes_needed - utf8_bytes_seen));\n\t\n\t    // 7. If utf-8 bytes seen is not equal to utf-8 bytes needed,\n\t    // continue.\n\t    if (utf8_bytes_seen !== utf8_bytes_needed)\n\t      return null;\n\t\n\t    // 8. Let code point be utf-8 code point.\n\t    var code_point = utf8_code_point;\n\t\n\t    // 9. Set utf-8 code point, utf-8 bytes needed, and utf-8 bytes\n\t    // seen to 0.\n\t    utf8_code_point = utf8_bytes_needed = utf8_bytes_seen = 0;\n\t\n\t    // 10. Return a code point whose value is code point.\n\t    return code_point;\n\t  };\n\t}\n\t\n\t/**\n\t * @constructor\n\t * @implements {Encoder}\n\t * @param {{fatal: boolean}} options\n\t */\n\tfunction UTF8Encoder(options) {\n\t  var fatal = options.fatal;\n\t  /**\n\t   * @param {Stream} stream Input stream.\n\t   * @param {number} code_point Next code point read from the stream.\n\t   * @return {(number|!Array.<number>)} Byte(s) to emit.\n\t   */\n\t  this.handler = function(stream, code_point) {\n\t    // 1. If code point is end-of-stream, return finished.\n\t    if (code_point === end_of_stream)\n\t      return finished;\n\t\n\t    // 2. If code point is in the range U+0000 to U+007F, return a\n\t    // byte whose value is code point.\n\t    if (inRange(code_point, 0x0000, 0x007f))\n\t      return code_point;\n\t\n\t    // 3. Set count and offset based on the range code point is in:\n\t    var count, offset;\n\t    // U+0080 to U+07FF:    1 and 0xC0\n\t    if (inRange(code_point, 0x0080, 0x07FF)) {\n\t      count = 1;\n\t      offset = 0xC0;\n\t    }\n\t    // U+0800 to U+FFFF:    2 and 0xE0\n\t    else if (inRange(code_point, 0x0800, 0xFFFF)) {\n\t      count = 2;\n\t      offset = 0xE0;\n\t    }\n\t    // U+10000 to U+10FFFF: 3 and 0xF0\n\t    else if (inRange(code_point, 0x10000, 0x10FFFF)) {\n\t      count = 3;\n\t      offset = 0xF0;\n\t    }\n\t\n\t    // 4.Let bytes be a byte sequence whose first byte is (code\n\t    // point >> (6 × count)) + offset.\n\t    var bytes = [(code_point >> (6 * count)) + offset];\n\t\n\t    // 5. Run these substeps while count is greater than 0:\n\t    while (count > 0) {\n\t\n\t      // 1. Set temp to code point >> (6 × (count − 1)).\n\t      var temp = code_point >> (6 * (count - 1));\n\t\n\t      // 2. Append to bytes 0x80 | (temp & 0x3F).\n\t      bytes.push(0x80 | (temp & 0x3F));\n\t\n\t      // 3. Decrease count by one.\n\t      count -= 1;\n\t    }\n\t\n\t    // 6. Return bytes bytes, in order.\n\t    return bytes;\n\t  };\n\t}\n\t\n\texports.TextEncoder = TextEncoder;\n\texports.TextDecoder = TextDecoder;\n\n/***/ }),\n\n/***/ 632:\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _promise = __webpack_require__(129);\n\t\n\tvar _promise2 = _interopRequireDefault(_promise);\n\t\n\tvar _react = __webpack_require__(1);\n\t\n\tvar _react2 = _interopRequireDefault(_react);\n\t\n\tvar _matrixJsSdk = __webpack_require__(30);\n\t\n\tvar Matrix = _interopRequireWildcard(_matrixJsSdk);\n\t\n\tvar _MegolmExportEncryption = __webpack_require__(647);\n\t\n\tvar MegolmExportEncryption = _interopRequireWildcard(_MegolmExportEncryption);\n\t\n\tvar _index = __webpack_require__(3);\n\t\n\tvar _index2 = _interopRequireDefault(_index);\n\t\n\tvar _languageHandler = __webpack_require__(2);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction readFileAsArrayBuffer(file) {\n\t    return new _promise2.default(function (resolve, reject) {\n\t        var reader = new FileReader();\n\t        reader.onload = function (e) {\n\t            resolve(e.target.result);\n\t        };\n\t        reader.onerror = reject;\n\t\n\t        reader.readAsArrayBuffer(file);\n\t    });\n\t} /*\n\t  Copyright 2017 Vector Creations Ltd\n\t  \n\t  Licensed under the Apache License, Version 2.0 (the \"License\");\n\t  you may not use this file except in compliance with the License.\n\t  You may obtain a copy of the License at\n\t  \n\t      http://www.apache.org/licenses/LICENSE-2.0\n\t  \n\t  Unless required by applicable law or agreed to in writing, software\n\t  distributed under the License is distributed on an \"AS IS\" BASIS,\n\t  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n\t  See the License for the specific language governing permissions and\n\t  limitations under the License.\n\t  */\n\t\n\tvar PHASE_EDIT = 1;\n\tvar PHASE_IMPORTING = 2;\n\t\n\texports.default = _react2.default.createClass({\n\t    displayName: 'ImportE2eKeysDialog',\n\t\n\t    propTypes: {\n\t        matrixClient: _react2.default.PropTypes.instanceOf(Matrix.MatrixClient).isRequired,\n\t        onFinished: _react2.default.PropTypes.func.isRequired\n\t    },\n\t\n\t    getInitialState: function getInitialState() {\n\t        return {\n\t            enableSubmit: false,\n\t            phase: PHASE_EDIT,\n\t            errStr: null\n\t        };\n\t    },\n\t\n\t    componentWillMount: function componentWillMount() {\n\t        this._unmounted = false;\n\t    },\n\t\n\t    componentWillUnmount: function componentWillUnmount() {\n\t        this._unmounted = true;\n\t    },\n\t\n\t    _onFormChange: function _onFormChange(ev) {\n\t        var files = this.refs.file.files || [];\n\t        this.setState({\n\t            enableSubmit: this.refs.passphrase.value !== \"\" && files.length > 0\n\t        });\n\t    },\n\t\n\t    _onFormSubmit: function _onFormSubmit(ev) {\n\t        ev.preventDefault();\n\t        this._startImport(this.refs.file.files[0], this.refs.passphrase.value);\n\t        return false;\n\t    },\n\t\n\t    _startImport: function _startImport(file, passphrase) {\n\t        var _this = this;\n\t\n\t        this.setState({\n\t            errStr: null,\n\t            phase: PHASE_IMPORTING\n\t        });\n\t\n\t        return readFileAsArrayBuffer(file).then(function (arrayBuffer) {\n\t            return MegolmExportEncryption.decryptMegolmKeyFile(arrayBuffer, passphrase);\n\t        }).then(function (keys) {\n\t            return _this.props.matrixClient.importRoomKeys(JSON.parse(keys));\n\t        }).then(function () {\n\t            // TODO: it would probably be nice to give some feedback about what we've imported here.\n\t            _this.props.onFinished(true);\n\t        }).catch(function (e) {\n\t            console.error(\"Error importing e2e keys:\", e);\n\t            if (_this._unmounted) {\n\t                return;\n\t            }\n\t            var msg = e.friendlyText || (0, _languageHandler._t)('Unknown error');\n\t            _this.setState({\n\t                errStr: msg,\n\t                phase: PHASE_EDIT\n\t            });\n\t        });\n\t    },\n\t\n\t    _onCancelClick: function _onCancelClick(ev) {\n\t        ev.preventDefault();\n\t        this.props.onFinished(false);\n\t        return false;\n\t    },\n\t\n\t    render: function render() {\n\t        var BaseDialog = _index2.default.getComponent('views.dialogs.BaseDialog');\n\t\n\t        var disableForm = this.state.phase !== PHASE_EDIT;\n\t\n\t        return _react2.default.createElement(\n\t            BaseDialog,\n\t            { className: 'mx_importE2eKeysDialog',\n\t                onFinished: this.props.onFinished,\n\t                title: (0, _languageHandler._t)(\"Import room keys\")\n\t            },\n\t            _react2.default.createElement(\n\t                'form',\n\t                { onSubmit: this._onFormSubmit },\n\t                _react2.default.createElement(\n\t                    'div',\n\t                    { className: 'mx_Dialog_content' },\n\t                    _react2.default.createElement(\n\t                        'p',\n\t                        null,\n\t                        (0, _languageHandler._t)('This process allows you to import encryption keys ' + 'that you had previously exported from another Matrix ' + 'client. You will then be able to decrypt any ' + 'messages that the other client could decrypt.')\n\t                    ),\n\t                    _react2.default.createElement(\n\t                        'p',\n\t                        null,\n\t                        (0, _languageHandler._t)('The export file will be protected with a passphrase. ' + 'You should enter the passphrase here, to decrypt the file.')\n\t                    ),\n\t                    _react2.default.createElement(\n\t                        'div',\n\t                        { className: 'error' },\n\t                        this.state.errStr\n\t                    ),\n\t                    _react2.default.createElement(\n\t                        'div',\n\t                        { className: 'mx_E2eKeysDialog_inputTable' },\n\t                        _react2.default.createElement(\n\t                            'div',\n\t                            { className: 'mx_E2eKeysDialog_inputRow' },\n\t                            _react2.default.createElement(\n\t                                'div',\n\t                                { className: 'mx_E2eKeysDialog_inputLabel' },\n\t                                _react2.default.createElement(\n\t                                    'label',\n\t                                    { htmlFor: 'importFile' },\n\t                                    (0, _languageHandler._t)(\"File to import\")\n\t                                )\n\t                            ),\n\t                            _react2.default.createElement(\n\t                                'div',\n\t                                { className: 'mx_E2eKeysDialog_inputCell' },\n\t                                _react2.default.createElement('input', { ref: 'file', id: 'importFile', type: 'file',\n\t                                    autoFocus: true,\n\t                                    onChange: this._onFormChange,\n\t                                    disabled: disableForm })\n\t                            )\n\t                        ),\n\t                        _react2.default.createElement(\n\t                            'div',\n\t                            { className: 'mx_E2eKeysDialog_inputRow' },\n\t                            _react2.default.createElement(\n\t                                'div',\n\t                                { className: 'mx_E2eKeysDialog_inputLabel' },\n\t                                _react2.default.createElement(\n\t                                    'label',\n\t                                    { htmlFor: 'passphrase' },\n\t                                    (0, _languageHandler._t)(\"Enter passphrase\")\n\t                                )\n\t                            ),\n\t                            _react2.default.createElement(\n\t                                'div',\n\t                                { className: 'mx_E2eKeysDialog_inputCell' },\n\t                                _react2.default.createElement('input', { ref: 'passphrase', id: 'passphrase',\n\t                                    size: '64', type: 'password',\n\t                                    onChange: this._onFormChange,\n\t                                    disabled: disableForm })\n\t                            )\n\t                        )\n\t                    )\n\t                ),\n\t                _react2.default.createElement(\n\t                    'div',\n\t                    { className: 'mx_Dialog_buttons' },\n\t                    _react2.default.createElement('input', { className: 'mx_Dialog_primary', type: 'submit', value: (0, _languageHandler._t)('Import'),\n\t                        disabled: !this.state.enableSubmit || disableForm\n\t                    }),\n\t                    _react2.default.createElement(\n\t                        'button',\n\t                        { onClick: this._onCancelClick, disabled: disableForm },\n\t                        (0, _languageHandler._t)(\"Cancel\")\n\t                    )\n\t                )\n\t            )\n\t        );\n\t    }\n\t});\n\tmodule.exports = exports['default'];\n\n\n/***/ }),\n\n/***/ 647:\n/***/ (function(module, exports, __webpack_require__) {\n\n\t/*\n\tCopyright 2017 Vector Creations Ltd\n\t\n\tLicensed under the Apache License, Version 2.0 (the \"License\");\n\tyou may not use this file except in compliance with the License.\n\tYou may obtain a copy of the License at\n\t\n\t    http://www.apache.org/licenses/LICENSE-2.0\n\t\n\tUnless required by applicable law or agreed to in writing, software\n\tdistributed under the License is distributed on an \"AS IS\" BASIS,\n\tWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n\tSee the License for the specific language governing permissions and\n\tlimitations under the License.\n\t*/\n\t\n\t\"use strict\";\n\t\n\t// polyfill textencoder if necessary\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.encryptMegolmKeyFile = exports.decryptMegolmKeyFile = undefined;\n\t\n\tvar _promise = __webpack_require__(129);\n\t\n\tvar _promise2 = _interopRequireDefault(_promise);\n\t\n\tvar _regenerator = __webpack_require__(45);\n\t\n\tvar _regenerator2 = _interopRequireDefault(_regenerator);\n\t\n\tvar _slicedToArray2 = __webpack_require__(187);\n\t\n\tvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\t\n\tvar _bluebird = __webpack_require__(8);\n\t\n\t/**\n\t * Decrypt a megolm key file\n\t *\n\t * @param {ArrayBuffer} data file to decrypt\n\t * @param {String} password\n\t * @return {Promise<String>} promise for decrypted output\n\t *\n\t *\n\t */\n\tvar decryptMegolmKeyFile = exports.decryptMegolmKeyFile = function () {\n\t    var _ref = (0, _bluebird.coroutine)(_regenerator2.default.mark(function _callee(data, password) {\n\t        var body, version, ciphertextLength, salt, iv, iterations, ciphertext, hmac, _ref2, _ref3, aesKey, hmacKey, toVerify, isValid, plaintext;\n\t\n\t        return _regenerator2.default.wrap(function _callee$(_context) {\n\t            while (1) {\n\t                switch (_context.prev = _context.next) {\n\t                    case 0:\n\t                        body = unpackMegolmKeyFile(data);\n\t\n\t                        // check we have a version byte\n\t\n\t                        if (!(body.length < 1)) {\n\t                            _context.next = 3;\n\t                            break;\n\t                        }\n\t\n\t                        throw friendlyError('Invalid file: too short', (0, _languageHandler._t)('Not a valid Riot keyfile'));\n\t\n\t                    case 3:\n\t                        version = body[0];\n\t\n\t                        if (!(version !== 1)) {\n\t                            _context.next = 6;\n\t                            break;\n\t                        }\n\t\n\t                        throw friendlyError('Unsupported version', (0, _languageHandler._t)('Not a valid Riot keyfile'));\n\t\n\t                    case 6:\n\t                        ciphertextLength = body.length - (1 + 16 + 16 + 4 + 32);\n\t\n\t                        if (!(ciphertextLength < 0)) {\n\t                            _context.next = 9;\n\t                            break;\n\t                        }\n\t\n\t                        throw friendlyError('Invalid file: too short', (0, _languageHandler._t)('Not a valid Riot keyfile'));\n\t\n\t                    case 9:\n\t                        salt = body.subarray(1, 1 + 16);\n\t                        iv = body.subarray(17, 17 + 16);\n\t                        iterations = body[33] << 24 | body[34] << 16 | body[35] << 8 | body[36];\n\t                        ciphertext = body.subarray(37, 37 + ciphertextLength);\n\t                        hmac = body.subarray(-32);\n\t                        _context.next = 16;\n\t                        return (0, _bluebird.resolve)(deriveKeys(salt, iterations, password));\n\t\n\t                    case 16:\n\t                        _ref2 = _context.sent;\n\t                        _ref3 = (0, _slicedToArray3.default)(_ref2, 2);\n\t                        aesKey = _ref3[0];\n\t                        hmacKey = _ref3[1];\n\t                        toVerify = body.subarray(0, -32);\n\t                        isValid = void 0;\n\t                        _context.prev = 22;\n\t                        _context.next = 25;\n\t                        return (0, _bluebird.resolve)(subtleCrypto.verify({ name: 'HMAC' }, hmacKey, hmac, toVerify));\n\t\n\t                    case 25:\n\t                        isValid = _context.sent;\n\t                        _context.next = 31;\n\t                        break;\n\t\n\t                    case 28:\n\t                        _context.prev = 28;\n\t                        _context.t0 = _context['catch'](22);\n\t                        throw friendlyError('subtleCrypto.verify failed: ' + _context.t0, cryptoFailMsg());\n\t\n\t                    case 31:\n\t                        if (isValid) {\n\t                            _context.next = 33;\n\t                            break;\n\t                        }\n\t\n\t                        throw friendlyError('hmac mismatch', (0, _languageHandler._t)('Authentication check failed: incorrect password?'));\n\t\n\t                    case 33:\n\t                        plaintext = void 0;\n\t                        _context.prev = 34;\n\t                        _context.next = 37;\n\t                        return (0, _bluebird.resolve)(subtleCrypto.decrypt({\n\t                            name: \"AES-CTR\",\n\t                            counter: iv,\n\t                            length: 64\n\t                        }, aesKey, ciphertext));\n\t\n\t                    case 37:\n\t                        plaintext = _context.sent;\n\t                        _context.next = 43;\n\t                        break;\n\t\n\t                    case 40:\n\t                        _context.prev = 40;\n\t                        _context.t1 = _context['catch'](34);\n\t                        throw friendlyError('subtleCrypto.decrypt failed: ' + _context.t1, cryptoFailMsg());\n\t\n\t                    case 43:\n\t                        return _context.abrupt('return', new TextDecoder().decode(new Uint8Array(plaintext)));\n\t\n\t                    case 44:\n\t                    case 'end':\n\t                        return _context.stop();\n\t                }\n\t            }\n\t        }, _callee, this, [[22, 28], [34, 40]]);\n\t    }));\n\t\n\t    return function decryptMegolmKeyFile(_x, _x2) {\n\t        return _ref.apply(this, arguments);\n\t    };\n\t}();\n\t\n\t/**\n\t * Encrypt a megolm key file\n\t *\n\t * @param {String} data\n\t * @param {String} password\n\t * @param {Object=} options\n\t * @param {Nunber=} options.kdf_rounds Number of iterations to perform of the\n\t *    key-derivation function.\n\t * @return {Promise<ArrayBuffer>} promise for encrypted output\n\t */\n\t\n\t\n\tvar encryptMegolmKeyFile = exports.encryptMegolmKeyFile = function () {\n\t    var _ref4 = (0, _bluebird.coroutine)(_regenerator2.default.mark(function _callee2(data, password, options) {\n\t        var kdfRounds, salt, iv, _ref5, _ref6, aesKey, hmacKey, encodedData, ciphertext, cipherArray, bodyLength, resultBuffer, idx, toSign, hmac, hmacArray;\n\t\n\t        return _regenerator2.default.wrap(function _callee2$(_context2) {\n\t            while (1) {\n\t                switch (_context2.prev = _context2.next) {\n\t                    case 0:\n\t                        options = options || {};\n\t                        kdfRounds = options.kdf_rounds || 500000;\n\t                        salt = new Uint8Array(16);\n\t\n\t                        window.crypto.getRandomValues(salt);\n\t\n\t                        iv = new Uint8Array(16);\n\t\n\t                        window.crypto.getRandomValues(iv);\n\t\n\t                        // clear bit 63 of the IV to stop us hitting the 64-bit counter boundary\n\t                        // (which would mean we wouldn't be able to decrypt on Android). The loss\n\t                        // of a single bit of iv is a price we have to pay.\n\t                        iv[9] &= 0x7f;\n\t\n\t                        _context2.next = 9;\n\t                        return (0, _bluebird.resolve)(deriveKeys(salt, kdfRounds, password));\n\t\n\t                    case 9:\n\t                        _ref5 = _context2.sent;\n\t                        _ref6 = (0, _slicedToArray3.default)(_ref5, 2);\n\t                        aesKey = _ref6[0];\n\t                        hmacKey = _ref6[1];\n\t                        encodedData = new TextEncoder().encode(data);\n\t                        ciphertext = void 0;\n\t                        _context2.prev = 15;\n\t                        _context2.next = 18;\n\t                        return (0, _bluebird.resolve)(subtleCrypto.encrypt({\n\t                            name: \"AES-CTR\",\n\t                            counter: iv,\n\t                            length: 64\n\t                        }, aesKey, encodedData));\n\t\n\t                    case 18:\n\t                        ciphertext = _context2.sent;\n\t                        _context2.next = 24;\n\t                        break;\n\t\n\t                    case 21:\n\t                        _context2.prev = 21;\n\t                        _context2.t0 = _context2['catch'](15);\n\t                        throw friendlyError('subtleCrypto.encrypt failed: ' + _context2.t0, cryptoFailMsg());\n\t\n\t                    case 24:\n\t                        cipherArray = new Uint8Array(ciphertext);\n\t                        bodyLength = 1 + salt.length + iv.length + 4 + cipherArray.length + 32;\n\t                        resultBuffer = new Uint8Array(bodyLength);\n\t                        idx = 0;\n\t\n\t                        resultBuffer[idx++] = 1; // version\n\t                        resultBuffer.set(salt, idx);idx += salt.length;\n\t                        resultBuffer.set(iv, idx);idx += iv.length;\n\t                        resultBuffer[idx++] = kdfRounds >> 24;\n\t                        resultBuffer[idx++] = kdfRounds >> 16 & 0xff;\n\t                        resultBuffer[idx++] = kdfRounds >> 8 & 0xff;\n\t                        resultBuffer[idx++] = kdfRounds & 0xff;\n\t                        resultBuffer.set(cipherArray, idx);idx += cipherArray.length;\n\t\n\t                        toSign = resultBuffer.subarray(0, idx);\n\t                        hmac = void 0;\n\t                        _context2.prev = 41;\n\t                        _context2.next = 44;\n\t                        return (0, _bluebird.resolve)(subtleCrypto.sign({ name: 'HMAC' }, hmacKey, toSign));\n\t\n\t                    case 44:\n\t                        hmac = _context2.sent;\n\t                        _context2.next = 50;\n\t                        break;\n\t\n\t                    case 47:\n\t                        _context2.prev = 47;\n\t                        _context2.t1 = _context2['catch'](41);\n\t                        throw friendlyError('subtleCrypto.sign failed: ' + _context2.t1, cryptoFailMsg());\n\t\n\t                    case 50:\n\t                        hmacArray = new Uint8Array(hmac);\n\t\n\t                        resultBuffer.set(hmacArray, idx);\n\t                        return _context2.abrupt('return', packMegolmKeyFile(resultBuffer));\n\t\n\t                    case 53:\n\t                    case 'end':\n\t                        return _context2.stop();\n\t                }\n\t            }\n\t        }, _callee2, this, [[15, 21], [41, 47]]);\n\t    }));\n\t\n\t    return function encryptMegolmKeyFile(_x3, _x4, _x5) {\n\t        return _ref4.apply(this, arguments);\n\t    };\n\t}();\n\t\n\t/**\n\t * Derive the AES and HMAC-SHA-256 keys for the file\n\t *\n\t * @param {Unit8Array} salt  salt for pbkdf\n\t * @param {Number} iterations number of pbkdf iterations\n\t * @param {String} password  password\n\t * @return {Promise<[CryptoKey, CryptoKey]>} promise for [aes key, hmac key]\n\t */\n\t\n\t\n\tvar deriveKeys = function () {\n\t    var _ref7 = (0, _bluebird.coroutine)(_regenerator2.default.mark(function _callee3(salt, iterations, password) {\n\t        var start, key, keybits, now, aesKey, hmacKey, aesProm, hmacProm;\n\t        return _regenerator2.default.wrap(function _callee3$(_context3) {\n\t            while (1) {\n\t                switch (_context3.prev = _context3.next) {\n\t                    case 0:\n\t                        start = new Date();\n\t                        key = void 0;\n\t                        _context3.prev = 2;\n\t                        _context3.next = 5;\n\t                        return (0, _bluebird.resolve)(subtleCrypto.importKey('raw', new TextEncoder().encode(password), { name: 'PBKDF2' }, false, ['deriveBits']));\n\t\n\t                    case 5:\n\t                        key = _context3.sent;\n\t                        _context3.next = 11;\n\t                        break;\n\t\n\t                    case 8:\n\t                        _context3.prev = 8;\n\t                        _context3.t0 = _context3['catch'](2);\n\t                        throw friendlyError('subtleCrypto.importKey failed: ' + _context3.t0, cryptoFailMsg());\n\t\n\t                    case 11:\n\t                        keybits = void 0;\n\t                        _context3.prev = 12;\n\t                        _context3.next = 15;\n\t                        return (0, _bluebird.resolve)(subtleCrypto.deriveBits({\n\t                            name: 'PBKDF2',\n\t                            salt: salt,\n\t                            iterations: iterations,\n\t                            hash: 'SHA-512'\n\t                        }, key, 512));\n\t\n\t                    case 15:\n\t                        keybits = _context3.sent;\n\t                        _context3.next = 21;\n\t                        break;\n\t\n\t                    case 18:\n\t                        _context3.prev = 18;\n\t                        _context3.t1 = _context3['catch'](12);\n\t                        throw friendlyError('subtleCrypto.deriveBits failed: ' + _context3.t1, cryptoFailMsg());\n\t\n\t                    case 21:\n\t                        now = new Date();\n\t\n\t                        console.log(\"E2e import/export: deriveKeys took \" + (now - start) + \"ms\");\n\t\n\t                        aesKey = keybits.slice(0, 32);\n\t                        hmacKey = keybits.slice(32);\n\t                        aesProm = subtleCrypto.importKey('raw', aesKey, { name: 'AES-CTR' }, false, ['encrypt', 'decrypt']).catch(function (e) {\n\t                            throw friendlyError('subtleCrypto.importKey failed for AES key: ' + e, cryptoFailMsg());\n\t                        });\n\t                        hmacProm = subtleCrypto.importKey('raw', hmacKey, {\n\t                            name: 'HMAC',\n\t                            hash: { name: 'SHA-256' }\n\t                        }, false, ['sign', 'verify']).catch(function (e) {\n\t                            throw friendlyError('subtleCrypto.importKey failed for HMAC key: ' + e, cryptoFailMsg());\n\t                        });\n\t                        _context3.next = 29;\n\t                        return (0, _bluebird.resolve)(_promise2.default.all([aesProm, hmacProm]));\n\t\n\t                    case 29:\n\t                        return _context3.abrupt('return', _context3.sent);\n\t\n\t                    case 30:\n\t                    case 'end':\n\t                        return _context3.stop();\n\t                }\n\t            }\n\t        }, _callee3, this, [[2, 8], [12, 18]]);\n\t    }));\n\t\n\t    return function deriveKeys(_x6, _x7, _x8) {\n\t        return _ref7.apply(this, arguments);\n\t    };\n\t}();\n\t\n\tvar _textEncodingUtf = __webpack_require__(477);\n\t\n\tvar TextEncodingUtf8 = _interopRequireWildcard(_textEncodingUtf);\n\t\n\tvar _languageHandler = __webpack_require__(2);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar TextEncoder = window.TextEncoder;\n\tif (!TextEncoder) {\n\t    TextEncoder = TextEncodingUtf8.TextEncoder;\n\t}\n\tvar TextDecoder = window.TextDecoder;\n\tif (!TextDecoder) {\n\t    TextDecoder = TextEncodingUtf8.TextDecoder;\n\t}\n\t\n\tvar subtleCrypto = window.crypto.subtle || window.crypto.webkitSubtle;\n\t\n\t/**\n\t * Make an Error object which has a friendlyText property which is already\n\t * translated and suitable for showing to the user.\n\t *\n\t * @param {string} msg   message for the exception\n\t * @param {string} friendlyText\n\t * @returns {Error}\n\t */\n\tfunction friendlyError(msg, friendlyText) {\n\t    var e = new Error(msg);\n\t    e.friendlyText = friendlyText;\n\t    return e;\n\t}\n\t\n\tfunction cryptoFailMsg() {\n\t    return (0, _languageHandler._t)('Your browser does not support the required cryptography extensions');\n\t}\n\t\n\tvar HEADER_LINE = '-----BEGIN MEGOLM SESSION DATA-----';\n\tvar TRAILER_LINE = '-----END MEGOLM SESSION DATA-----';\n\t\n\t/**\n\t * Unbase64 an ascii-armoured megolm key file\n\t *\n\t * Strips the header and trailer lines, and unbase64s the content\n\t *\n\t * @param {ArrayBuffer} data  input file\n\t * @return {Uint8Array} unbase64ed content\n\t */\n\tfunction unpackMegolmKeyFile(data) {\n\t    // parse the file as a great big String. This should be safe, because there\n\t    // should be no non-ASCII characters, and it means that we can do string\n\t    // comparisons to find the header and footer, and feed it into window.atob.\n\t    var fileStr = new TextDecoder().decode(new Uint8Array(data));\n\t\n\t    // look for the start line\n\t    var lineStart = 0;\n\t    while (1) {\n\t        var lineEnd = fileStr.indexOf('\\n', lineStart);\n\t        if (lineEnd < 0) {\n\t            throw new Error('Header line not found');\n\t        }\n\t        var line = fileStr.slice(lineStart, lineEnd).trim();\n\t\n\t        // start the next line after the newline\n\t        lineStart = lineEnd + 1;\n\t\n\t        if (line === HEADER_LINE) {\n\t            break;\n\t        }\n\t    }\n\t\n\t    var dataStart = lineStart;\n\t\n\t    // look for the end line\n\t    while (1) {\n\t        var _lineEnd = fileStr.indexOf('\\n', lineStart);\n\t        var _line = fileStr.slice(lineStart, _lineEnd < 0 ? undefined : _lineEnd).trim();\n\t        if (_line === TRAILER_LINE) {\n\t            break;\n\t        }\n\t\n\t        if (_lineEnd < 0) {\n\t            throw new Error('Trailer line not found');\n\t        }\n\t\n\t        // start the next line after the newline\n\t        lineStart = _lineEnd + 1;\n\t    }\n\t\n\t    var dataEnd = lineStart;\n\t    return decodeBase64(fileStr.slice(dataStart, dataEnd));\n\t}\n\t\n\t/**\n\t * ascii-armour a  megolm key file\n\t *\n\t * base64s the content, and adds header and trailer lines\n\t *\n\t * @param {Uint8Array} data  raw data\n\t * @return {ArrayBuffer} formatted file\n\t */\n\tfunction packMegolmKeyFile(data) {\n\t    // we split into lines before base64ing, because encodeBase64 doesn't deal\n\t    // terribly well with large arrays.\n\t    var LINE_LENGTH = 72 * 4 / 3;\n\t    var nLines = Math.ceil(data.length / LINE_LENGTH);\n\t    var lines = new Array(nLines + 3);\n\t    lines[0] = HEADER_LINE;\n\t    var o = 0;\n\t    var i = void 0;\n\t    for (i = 1; i <= nLines; i++) {\n\t        lines[i] = encodeBase64(data.subarray(o, o + LINE_LENGTH));\n\t        o += LINE_LENGTH;\n\t    }\n\t    lines[i++] = TRAILER_LINE;\n\t    lines[i] = '';\n\t    return new TextEncoder().encode(lines.join('\\n')).buffer;\n\t}\n\t\n\t/**\n\t * Encode a typed array of uint8 as base64.\n\t * @param {Uint8Array} uint8Array The data to encode.\n\t * @return {string} The base64.\n\t */\n\tfunction encodeBase64(uint8Array) {\n\t    // Misinterpt the Uint8Array as Latin-1.\n\t    // window.btoa expects a unicode string with codepoints in the range 0-255.\n\t    var latin1String = String.fromCharCode.apply(null, uint8Array);\n\t    // Use the builtin base64 encoder.\n\t    return window.btoa(latin1String);\n\t}\n\t\n\t/**\n\t * Decode a base64 string to a typed array of uint8.\n\t * @param {string} base64 The base64 to decode.\n\t * @return {Uint8Array} The decoded data.\n\t */\n\tfunction decodeBase64(base64) {\n\t    // window.atob returns a unicode string with codepoints in the range 0-255.\n\t    var latin1String = window.atob(base64);\n\t    // Encode the string as a Uint8Array\n\t    var uint8Array = new Uint8Array(latin1String.length);\n\t    for (var i = 0; i < latin1String.length; i++) {\n\t        uint8Array[i] = latin1String.charCodeAt(i);\n\t    }\n\t    return uint8Array;\n\t}\n\n\n/***/ }),\n\n/***/ 1173:\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_RESULT__;/* FileSaver.js\n\t * A saveAs() FileSaver implementation.\n\t * 1.3.2\n\t * 2016-06-16 18:25:19\n\t *\n\t * By Eli Grey, http://eligrey.com\n\t * License: MIT\n\t *   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md\n\t */\n\t\n\t/*global self */\n\t/*jslint bitwise: true, indent: 4, laxbreak: true, laxcomma: true, smarttabs: true, plusplus: true */\n\t\n\t/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */\n\t\n\tvar saveAs = saveAs || (function(view) {\n\t\t\"use strict\";\n\t\t// IE <10 is explicitly unsupported\n\t\tif (typeof view === \"undefined\" || typeof navigator !== \"undefined\" && /MSIE [1-9]\\./.test(navigator.userAgent)) {\n\t\t\treturn;\n\t\t}\n\t\tvar\n\t\t\t  doc = view.document\n\t\t\t  // only get URL when necessary in case Blob.js hasn't overridden it yet\n\t\t\t, get_URL = function() {\n\t\t\t\treturn view.URL || view.webkitURL || view;\n\t\t\t}\n\t\t\t, save_link = doc.createElementNS(\"http://www.w3.org/1999/xhtml\", \"a\")\n\t\t\t, can_use_save_link = \"download\" in save_link\n\t\t\t, click = function(node) {\n\t\t\t\tvar event = new MouseEvent(\"click\");\n\t\t\t\tnode.dispatchEvent(event);\n\t\t\t}\n\t\t\t, is_safari = /constructor/i.test(view.HTMLElement) || view.safari\n\t\t\t, is_chrome_ios =/CriOS\\/[\\d]+/.test(navigator.userAgent)\n\t\t\t, throw_outside = function(ex) {\n\t\t\t\t(view.setImmediate || view.setTimeout)(function() {\n\t\t\t\t\tthrow ex;\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t\t, force_saveable_type = \"application/octet-stream\"\n\t\t\t// the Blob API is fundamentally broken as there is no \"downloadfinished\" event to subscribe to\n\t\t\t, arbitrary_revoke_timeout = 1000 * 40 // in ms\n\t\t\t, revoke = function(file) {\n\t\t\t\tvar revoker = function() {\n\t\t\t\t\tif (typeof file === \"string\") { // file is an object URL\n\t\t\t\t\t\tget_URL().revokeObjectURL(file);\n\t\t\t\t\t} else { // file is a File\n\t\t\t\t\t\tfile.remove();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tsetTimeout(revoker, arbitrary_revoke_timeout);\n\t\t\t}\n\t\t\t, dispatch = function(filesaver, event_types, event) {\n\t\t\t\tevent_types = [].concat(event_types);\n\t\t\t\tvar i = event_types.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tvar listener = filesaver[\"on\" + event_types[i]];\n\t\t\t\t\tif (typeof listener === \"function\") {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tlistener.call(filesaver, event || filesaver);\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\tthrow_outside(ex);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t, auto_bom = function(blob) {\n\t\t\t\t// prepend BOM for UTF-8 XML and text/* types (including HTML)\n\t\t\t\t// note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n\t\t\t\tif (/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n\t\t\t\t\treturn new Blob([String.fromCharCode(0xFEFF), blob], {type: blob.type});\n\t\t\t\t}\n\t\t\t\treturn blob;\n\t\t\t}\n\t\t\t, FileSaver = function(blob, name, no_auto_bom) {\n\t\t\t\tif (!no_auto_bom) {\n\t\t\t\t\tblob = auto_bom(blob);\n\t\t\t\t}\n\t\t\t\t// First try a.download, then web filesystem, then object URLs\n\t\t\t\tvar\n\t\t\t\t\t  filesaver = this\n\t\t\t\t\t, type = blob.type\n\t\t\t\t\t, force = type === force_saveable_type\n\t\t\t\t\t, object_url\n\t\t\t\t\t, dispatch_all = function() {\n\t\t\t\t\t\tdispatch(filesaver, \"writestart progress write writeend\".split(\" \"));\n\t\t\t\t\t}\n\t\t\t\t\t// on any filesys errors revert to saving with object URLs\n\t\t\t\t\t, fs_error = function() {\n\t\t\t\t\t\tif ((is_chrome_ios || (force && is_safari)) && view.FileReader) {\n\t\t\t\t\t\t\t// Safari doesn't allow downloading of blob urls\n\t\t\t\t\t\t\tvar reader = new FileReader();\n\t\t\t\t\t\t\treader.onloadend = function() {\n\t\t\t\t\t\t\t\tvar url = is_chrome_ios ? reader.result : reader.result.replace(/^data:[^;]*;/, 'data:attachment/file;');\n\t\t\t\t\t\t\t\tvar popup = view.open(url, '_blank');\n\t\t\t\t\t\t\t\tif(!popup) view.location.href = url;\n\t\t\t\t\t\t\t\turl=undefined; // release reference before dispatching\n\t\t\t\t\t\t\t\tfilesaver.readyState = filesaver.DONE;\n\t\t\t\t\t\t\t\tdispatch_all();\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treader.readAsDataURL(blob);\n\t\t\t\t\t\t\tfilesaver.readyState = filesaver.INIT;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// don't create more object URLs than needed\n\t\t\t\t\t\tif (!object_url) {\n\t\t\t\t\t\t\tobject_url = get_URL().createObjectURL(blob);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (force) {\n\t\t\t\t\t\t\tview.location.href = object_url;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar opened = view.open(object_url, \"_blank\");\n\t\t\t\t\t\t\tif (!opened) {\n\t\t\t\t\t\t\t\t// Apple does not allow window.open, see https://developer.apple.com/library/safari/documentation/Tools/Conceptual/SafariExtensionGuide/WorkingwithWindowsandTabs/WorkingwithWindowsandTabs.html\n\t\t\t\t\t\t\t\tview.location.href = object_url;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfilesaver.readyState = filesaver.DONE;\n\t\t\t\t\t\tdispatch_all();\n\t\t\t\t\t\trevoke(object_url);\n\t\t\t\t\t}\n\t\t\t\t;\n\t\t\t\tfilesaver.readyState = filesaver.INIT;\n\t\n\t\t\t\tif (can_use_save_link) {\n\t\t\t\t\tobject_url = get_URL().createObjectURL(blob);\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tsave_link.href = object_url;\n\t\t\t\t\t\tsave_link.download = name;\n\t\t\t\t\t\tclick(save_link);\n\t\t\t\t\t\tdispatch_all();\n\t\t\t\t\t\trevoke(object_url);\n\t\t\t\t\t\tfilesaver.readyState = filesaver.DONE;\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\n\t\t\t\tfs_error();\n\t\t\t}\n\t\t\t, FS_proto = FileSaver.prototype\n\t\t\t, saveAs = function(blob, name, no_auto_bom) {\n\t\t\t\treturn new FileSaver(blob, name || blob.name || \"download\", no_auto_bom);\n\t\t\t}\n\t\t;\n\t\t// IE 10+ (native saveAs)\n\t\tif (typeof navigator !== \"undefined\" && navigator.msSaveOrOpenBlob) {\n\t\t\treturn function(blob, name, no_auto_bom) {\n\t\t\t\tname = name || blob.name || \"download\";\n\t\n\t\t\t\tif (!no_auto_bom) {\n\t\t\t\t\tblob = auto_bom(blob);\n\t\t\t\t}\n\t\t\t\treturn navigator.msSaveOrOpenBlob(blob, name);\n\t\t\t};\n\t\t}\n\t\n\t\tFS_proto.abort = function(){};\n\t\tFS_proto.readyState = FS_proto.INIT = 0;\n\t\tFS_proto.WRITING = 1;\n\t\tFS_proto.DONE = 2;\n\t\n\t\tFS_proto.error =\n\t\tFS_proto.onwritestart =\n\t\tFS_proto.onprogress =\n\t\tFS_proto.onwrite =\n\t\tFS_proto.onabort =\n\t\tFS_proto.onerror =\n\t\tFS_proto.onwriteend =\n\t\t\tnull;\n\t\n\t\treturn saveAs;\n\t}(\n\t\t   typeof self !== \"undefined\" && self\n\t\t|| typeof window !== \"undefined\" && window\n\t\t|| this.content\n\t));\n\t// `self` is undefined in Firefox for Android content script context\n\t// while `this` is nsIContentFrameMessageManager\n\t// with an attribute `content` that corresponds to the window\n\t\n\tif (typeof module !== \"undefined\" && module.exports) {\n\t  module.exports.saveAs = saveAs;\n\t} else if ((\"function\" !== \"undefined\" && __webpack_require__(699) !== null) && (__webpack_require__(700) !== null)) {\n\t  !(__WEBPACK_AMD_DEFINE_RESULT__ = function() {\n\t    return saveAs;\n\t  }.call(exports, __webpack_require__, exports, module), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t}\n\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// bundles/f0f51e0c471b5b038462/e2e-export.js","/*\nCopyright 2017 Vector Creations Ltd\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport FileSaver from 'file-saver';\nimport React from 'react';\nimport { _t } from '../../../languageHandler';\n\nimport * as Matrix from 'matrix-js-sdk';\nimport * as MegolmExportEncryption from '../../../utils/MegolmExportEncryption';\nimport sdk from '../../../index';\n\nconst PHASE_EDIT = 1;\nconst PHASE_EXPORTING = 2;\n\nexport default React.createClass({\n    displayName: 'ExportE2eKeysDialog',\n\n    propTypes: {\n        matrixClient: React.PropTypes.instanceOf(Matrix.MatrixClient).isRequired,\n        onFinished: React.PropTypes.func.isRequired,\n    },\n\n    getInitialState: function() {\n        return {\n            phase: PHASE_EDIT,\n            errStr: null,\n        };\n    },\n\n    componentWillMount: function() {\n        this._unmounted = false;\n    },\n\n    componentWillUnmount: function() {\n        this._unmounted = true;\n    },\n\n    _onPassphraseFormSubmit: function(ev) {\n        ev.preventDefault();\n\n        const passphrase = this.refs.passphrase1.value;\n        if (passphrase !== this.refs.passphrase2.value) {\n            this.setState({errStr: _t('Passphrases must match')});\n            return false;\n        }\n        if (!passphrase) {\n            this.setState({errStr: _t('Passphrase must not be empty')});\n            return false;\n        }\n\n        this._startExport(passphrase);\n        return false;\n    },\n\n    _startExport: function(passphrase) {\n        // extra Promise.resolve() to turn synchronous exceptions into\n        // asynchronous ones.\n        Promise.resolve().then(() => {\n            return this.props.matrixClient.exportRoomKeys();\n        }).then((k) => {\n            return MegolmExportEncryption.encryptMegolmKeyFile(\n                JSON.stringify(k), passphrase,\n            );\n        }).then((f) => {\n            const blob = new Blob([f], {\n                type: 'text/plain;charset=us-ascii',\n            });\n            FileSaver.saveAs(blob, 'riot-keys.txt');\n            this.props.onFinished(true);\n        }).catch((e) => {\n            console.error(\"Error exporting e2e keys:\", e);\n            if (this._unmounted) {\n                return;\n            }\n            const msg = e.friendlyText || _t('Unknown error');\n            this.setState({\n                errStr: msg,\n                phase: PHASE_EDIT,\n            });\n        });\n\n        this.setState({\n            errStr: null,\n            phase: PHASE_EXPORTING,\n        });\n    },\n\n    _onCancelClick: function(ev) {\n        ev.preventDefault();\n        this.props.onFinished(false);\n        return false;\n    },\n\n    render: function() {\n        const BaseDialog = sdk.getComponent('views.dialogs.BaseDialog');\n\n        const disableForm = (this.state.phase === PHASE_EXPORTING);\n\n        return (\n            <BaseDialog className='mx_exportE2eKeysDialog'\n                onFinished={this.props.onFinished}\n                title={_t(\"Export room keys\")}\n            >\n                <form onSubmit={this._onPassphraseFormSubmit}>\n                    <div className=\"mx_Dialog_content\">\n                        <p>\n                            { _t(\n                                'This process allows you to export the keys for messages ' +\n                                'you have received in encrypted rooms to a local file. You ' +\n                                'will then be able to import the file into another Matrix ' +\n                                'client in the future, so that client will also be able to ' +\n                                'decrypt these messages.',\n                            ) }\n                        </p>\n                        <p>\n                            { _t(\n                                'The exported file will allow anyone who can read it to decrypt ' +\n                                'any encrypted messages that you can see, so you should be ' +\n                                'careful to keep it secure. To help with this, you should enter ' +\n                                'a passphrase below, which will be used to encrypt the exported ' +\n                                'data. It will only be possible to import the data by using the ' +\n                                'same passphrase.',\n                            ) }\n                        </p>\n                        <div className='error'>\n                            {this.state.errStr}\n                        </div>\n                        <div className='mx_E2eKeysDialog_inputTable'>\n                            <div className='mx_E2eKeysDialog_inputRow'>\n                                <div className='mx_E2eKeysDialog_inputLabel'>\n                                    <label htmlFor='passphrase1'>\n                                        {_t(\"Enter passphrase\")}\n                                    </label>\n                                </div>\n                                <div className='mx_E2eKeysDialog_inputCell'>\n                                    <input ref='passphrase1' id='passphrase1'\n                                        autoFocus={true} size='64' type='password'\n                                        disabled={disableForm}\n                                    />\n                                </div>\n                            </div>\n                            <div className='mx_E2eKeysDialog_inputRow'>\n                                <div className='mx_E2eKeysDialog_inputLabel'>\n                                    <label htmlFor='passphrase2'>\n                                        {_t(\"Confirm passphrase\")}\n                                    </label>\n                                </div>\n                                <div className='mx_E2eKeysDialog_inputCell'>\n                                    <input ref='passphrase2' id='passphrase2'\n                                        size='64' type='password'\n                                        disabled={disableForm}\n                                    />\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div className='mx_Dialog_buttons'>\n                        <input className='mx_Dialog_primary' type='submit' value={_t('Export')}\n                             disabled={disableForm}\n                        />\n                        <button onClick={this._onCancelClick} disabled={disableForm}>\n                            {_t(\"Cancel\")}\n                        </button>\n                    </div>\n                </form>\n            </BaseDialog>\n        );\n    },\n});\n\n\n\n// WEBPACK FOOTER //\n// ../../../../src/async-components/views/dialogs/ExportE2eKeysDialog.js","'use strict';\n\n// This is free and unencumbered software released into the public domain.\n// See LICENSE.md for more information.\n\n//\n// Utilities\n//\n\n/**\n * @param {number} a The number to test.\n * @param {number} min The minimum value in the range, inclusive.\n * @param {number} max The maximum value in the range, inclusive.\n * @return {boolean} True if a >= min and a <= max.\n */\nfunction inRange(a, min, max) {\n  return min <= a && a <= max;\n}\n\n/**\n * @param {*} o\n * @return {Object}\n */\nfunction ToDictionary(o) {\n  if (o === undefined) return {};\n  if (o === Object(o)) return o;\n  throw TypeError('Could not convert argument to dictionary');\n}\n\n/**\n * @param {string} string Input string of UTF-16 code units.\n * @return {!Array.<number>} Code points.\n */\nfunction stringToCodePoints(string) {\n  // https://heycam.github.io/webidl/#dfn-obtain-unicode\n\n  // 1. Let S be the DOMString value.\n  var s = String(string);\n\n  // 2. Let n be the length of S.\n  var n = s.length;\n\n  // 3. Initialize i to 0.\n  var i = 0;\n\n  // 4. Initialize U to be an empty sequence of Unicode characters.\n  var u = [];\n\n  // 5. While i < n:\n  while (i < n) {\n\n    // 1. Let c be the code unit in S at index i.\n    var c = s.charCodeAt(i);\n\n    // 2. Depending on the value of c:\n\n    // c < 0xD800 or c > 0xDFFF\n    if (c < 0xD800 || c > 0xDFFF) {\n      // Append to U the Unicode character with code point c.\n      u.push(c);\n    }\n\n    // 0xDC00 ≤ c ≤ 0xDFFF\n    else if (0xDC00 <= c && c <= 0xDFFF) {\n      // Append to U a U+FFFD REPLACEMENT CHARACTER.\n      u.push(0xFFFD);\n    }\n\n    // 0xD800 ≤ c ≤ 0xDBFF\n    else if (0xD800 <= c && c <= 0xDBFF) {\n      // 1. If i = n−1, then append to U a U+FFFD REPLACEMENT\n      // CHARACTER.\n      if (i === n - 1) {\n        u.push(0xFFFD);\n      }\n      // 2. Otherwise, i < n−1:\n      else {\n        // 1. Let d be the code unit in S at index i+1.\n        var d = string.charCodeAt(i + 1);\n\n        // 2. If 0xDC00 ≤ d ≤ 0xDFFF, then:\n        if (0xDC00 <= d && d <= 0xDFFF) {\n          // 1. Let a be c & 0x3FF.\n          var a = c & 0x3FF;\n\n          // 2. Let b be d & 0x3FF.\n          var b = d & 0x3FF;\n\n          // 3. Append to U the Unicode character with code point\n          // 2^16+2^10*a+b.\n          u.push(0x10000 + (a << 10) + b);\n\n          // 4. Set i to i+1.\n          i += 1;\n        }\n\n        // 3. Otherwise, d < 0xDC00 or d > 0xDFFF. Append to U a\n        // U+FFFD REPLACEMENT CHARACTER.\n        else  {\n          u.push(0xFFFD);\n        }\n      }\n    }\n\n    // 3. Set i to i+1.\n    i += 1;\n  }\n\n  // 6. Return U.\n  return u;\n}\n\n/**\n * @param {!Array.<number>} code_points Array of code points.\n * @return {string} string String of UTF-16 code units.\n */\nfunction codePointsToString(code_points) {\n  var s = '';\n  for (var i = 0; i < code_points.length; ++i) {\n    var cp = code_points[i];\n    if (cp <= 0xFFFF) {\n      s += String.fromCharCode(cp);\n    } else {\n      cp -= 0x10000;\n      s += String.fromCharCode((cp >> 10) + 0xD800,\n                               (cp & 0x3FF) + 0xDC00);\n    }\n  }\n  return s;\n}\n\n\n//\n// Implementation of Encoding specification\n// https://encoding.spec.whatwg.org/\n//\n\n//\n// 3. Terminology\n//\n\n/**\n * End-of-stream is a special token that signifies no more tokens\n * are in the stream.\n * @const\n */ var end_of_stream = -1;\n\n/**\n * A stream represents an ordered sequence of tokens.\n *\n * @constructor\n * @param {!(Array.<number>|Uint8Array)} tokens Array of tokens that provide the\n * stream.\n */\nfunction Stream(tokens) {\n  /** @type {!Array.<number>} */\n  this.tokens = [].slice.call(tokens);\n}\n\nStream.prototype = {\n  /**\n   * @return {boolean} True if end-of-stream has been hit.\n   */\n  endOfStream: function() {\n    return !this.tokens.length;\n  },\n\n  /**\n   * When a token is read from a stream, the first token in the\n   * stream must be returned and subsequently removed, and\n   * end-of-stream must be returned otherwise.\n   *\n   * @return {number} Get the next token from the stream, or\n   * end_of_stream.\n   */\n   read: function() {\n    if (!this.tokens.length)\n      return end_of_stream;\n     return this.tokens.shift();\n   },\n\n  /**\n   * When one or more tokens are prepended to a stream, those tokens\n   * must be inserted, in given order, before the first token in the\n   * stream.\n   *\n   * @param {(number|!Array.<number>)} token The token(s) to prepend to the stream.\n   */\n  prepend: function(token) {\n    if (Array.isArray(token)) {\n      var tokens = /**@type {!Array.<number>}*/(token);\n      while (tokens.length)\n        this.tokens.unshift(tokens.pop());\n    } else {\n      this.tokens.unshift(token);\n    }\n  },\n\n  /**\n   * When one or more tokens are pushed to a stream, those tokens\n   * must be inserted, in given order, after the last token in the\n   * stream.\n   *\n   * @param {(number|!Array.<number>)} token The tokens(s) to prepend to the stream.\n   */\n  push: function(token) {\n    if (Array.isArray(token)) {\n      var tokens = /**@type {!Array.<number>}*/(token);\n      while (tokens.length)\n        this.tokens.push(tokens.shift());\n    } else {\n      this.tokens.push(token);\n    }\n  }\n};\n\n//\n// 4. Encodings\n//\n\n// 4.1 Encoders and decoders\n\n/** @const */\nvar finished = -1;\n\n/**\n * @param {boolean} fatal If true, decoding errors raise an exception.\n * @param {number=} opt_code_point Override the standard fallback code point.\n * @return {number} The code point to insert on a decoding error.\n */\nfunction decoderError(fatal, opt_code_point) {\n  if (fatal)\n    throw TypeError('Decoder error');\n  return opt_code_point || 0xFFFD;\n}\n\n//\n// 7. API\n//\n\n/** @const */ var DEFAULT_ENCODING = 'utf-8';\n\n// 7.1 Interface TextDecoder\n\n/**\n * @constructor\n * @param {string=} encoding The label of the encoding;\n *     defaults to 'utf-8'.\n * @param {Object=} options\n */\nfunction TextDecoder(encoding, options) {\n  if (!(this instanceof TextDecoder)) {\n    return new TextDecoder(encoding, options);\n  }\n  encoding = encoding !== undefined ? String(encoding).toLowerCase() : DEFAULT_ENCODING;\n  if (encoding !== DEFAULT_ENCODING) {\n    throw new Error('Encoding not supported. Only utf-8 is supported');\n  }\n  options = ToDictionary(options);\n\n  /** @private @type {boolean} */\n  this._streaming = false;\n  /** @private @type {boolean} */\n  this._BOMseen = false;\n  /** @private @type {?Decoder} */\n  this._decoder = null;\n  /** @private @type {boolean} */\n  this._fatal = Boolean(options['fatal']);\n  /** @private @type {boolean} */\n  this._ignoreBOM = Boolean(options['ignoreBOM']);\n\n  Object.defineProperty(this, 'encoding', {value: 'utf-8'});\n  Object.defineProperty(this, 'fatal', {value: this._fatal});\n  Object.defineProperty(this, 'ignoreBOM', {value: this._ignoreBOM});\n}\n\nTextDecoder.prototype = {\n  /**\n   * @param {ArrayBufferView=} input The buffer of bytes to decode.\n   * @param {Object=} options\n   * @return {string} The decoded string.\n   */\n  decode: function decode(input, options) {\n    var bytes;\n    if (typeof input === 'object' && input instanceof ArrayBuffer) {\n      bytes = new Uint8Array(input);\n    } else if (typeof input === 'object' && 'buffer' in input &&\n               input.buffer instanceof ArrayBuffer) {\n      bytes = new Uint8Array(input.buffer,\n                             input.byteOffset,\n                             input.byteLength);\n    } else {\n      bytes = new Uint8Array(0);\n    }\n\n    options = ToDictionary(options);\n\n    if (!this._streaming) {\n      this._decoder = new UTF8Decoder({fatal: this._fatal});\n      this._BOMseen = false;\n    }\n    this._streaming = Boolean(options['stream']);\n\n    var input_stream = new Stream(bytes);\n\n    var code_points = [];\n\n    /** @type {?(number|!Array.<number>)} */\n    var result;\n\n    while (!input_stream.endOfStream()) {\n      result = this._decoder.handler(input_stream, input_stream.read());\n      if (result === finished)\n        break;\n      if (result === null)\n        continue;\n      if (Array.isArray(result))\n        code_points.push.apply(code_points, /**@type {!Array.<number>}*/(result));\n      else\n        code_points.push(result);\n    }\n    if (!this._streaming) {\n      do {\n        result = this._decoder.handler(input_stream, input_stream.read());\n        if (result === finished)\n          break;\n        if (result === null)\n          continue;\n        if (Array.isArray(result))\n          code_points.push.apply(code_points, /**@type {!Array.<number>}*/(result));\n        else\n          code_points.push(result);\n      } while (!input_stream.endOfStream());\n      this._decoder = null;\n    }\n\n    if (code_points.length) {\n      // If encoding is one of utf-8, utf-16be, and utf-16le, and\n      // ignore BOM flag and BOM seen flag are unset, run these\n      // subsubsteps:\n      if (['utf-8'].indexOf(this.encoding) !== -1 &&\n          !this._ignoreBOM && !this._BOMseen) {\n        // If token is U+FEFF, set BOM seen flag.\n        if (code_points[0] === 0xFEFF) {\n          this._BOMseen = true;\n          code_points.shift();\n        } else {\n          // Otherwise, if token is not end-of-stream, set BOM seen\n          // flag and append token to output.\n          this._BOMseen = true;\n        }\n      }\n    }\n\n    return codePointsToString(code_points);\n  }\n};\n\n// 7.2 Interface TextEncoder\n\n/**\n * @constructor\n * @param {string=} encoding The label of the encoding;\n *     defaults to 'utf-8'.\n * @param {Object=} options\n */\nfunction TextEncoder(encoding, options) {\n  if (!(this instanceof TextEncoder))\n    return new TextEncoder(encoding, options);\n  encoding = encoding !== undefined ? String(encoding).toLowerCase() : DEFAULT_ENCODING;\n  if (encoding !== DEFAULT_ENCODING) {\n    throw new Error('Encoding not supported. Only utf-8 is supported');\n  }\n  options = ToDictionary(options);\n\n  /** @private @type {boolean} */\n  this._streaming = false;\n  /** @private @type {?Encoder} */\n  this._encoder = null;\n  /** @private @type {{fatal: boolean}} */\n  this._options = {fatal: Boolean(options['fatal'])};\n\n  Object.defineProperty(this, 'encoding', {value: 'utf-8'});\n}\n\nTextEncoder.prototype = {\n  /**\n   * @param {string=} opt_string The string to encode.\n   * @param {Object=} options\n   * @return {Uint8Array} Encoded bytes, as a Uint8Array.\n   */\n  encode: function encode(opt_string, options) {\n    opt_string = opt_string ? String(opt_string) : '';\n    options = ToDictionary(options);\n\n    // NOTE: This option is nonstandard. None of the encodings\n    // permitted for encoding (i.e. UTF-8, UTF-16) are stateful,\n    // so streaming is not necessary.\n    if (!this._streaming)\n      this._encoder = new UTF8Encoder(this._options);\n    this._streaming = Boolean(options['stream']);\n\n    var bytes = [];\n    var input_stream = new Stream(stringToCodePoints(opt_string));\n    /** @type {?(number|!Array.<number>)} */\n    var result;\n    while (!input_stream.endOfStream()) {\n      result = this._encoder.handler(input_stream, input_stream.read());\n      if (result === finished)\n        break;\n      if (Array.isArray(result))\n        bytes.push.apply(bytes, /**@type {!Array.<number>}*/(result));\n      else\n        bytes.push(result);\n    }\n    if (!this._streaming) {\n      while (true) {\n        result = this._encoder.handler(input_stream, input_stream.read());\n        if (result === finished)\n          break;\n        if (Array.isArray(result))\n          bytes.push.apply(bytes, /**@type {!Array.<number>}*/(result));\n        else\n          bytes.push(result);\n      }\n      this._encoder = null;\n    }\n    return new Uint8Array(bytes);\n  }\n};\n\n//\n// 8. The encoding\n//\n\n// 8.1 utf-8\n\n/**\n * @constructor\n * @implements {Decoder}\n * @param {{fatal: boolean}} options\n */\nfunction UTF8Decoder(options) {\n  var fatal = options.fatal;\n\n  // utf-8's decoder's has an associated utf-8 code point, utf-8\n  // bytes seen, and utf-8 bytes needed (all initially 0), a utf-8\n  // lower boundary (initially 0x80), and a utf-8 upper boundary\n  // (initially 0xBF).\n  var /** @type {number} */ utf8_code_point = 0,\n      /** @type {number} */ utf8_bytes_seen = 0,\n      /** @type {number} */ utf8_bytes_needed = 0,\n      /** @type {number} */ utf8_lower_boundary = 0x80,\n      /** @type {number} */ utf8_upper_boundary = 0xBF;\n\n  /**\n   * @param {Stream} stream The stream of bytes being decoded.\n   * @param {number} bite The next byte read from the stream.\n   * @return {?(number|!Array.<number>)} The next code point(s)\n   *     decoded, or null if not enough data exists in the input\n   *     stream to decode a complete code point.\n   */\n  this.handler = function(stream, bite) {\n    // 1. If byte is end-of-stream and utf-8 bytes needed is not 0,\n    // set utf-8 bytes needed to 0 and return error.\n    if (bite === end_of_stream && utf8_bytes_needed !== 0) {\n      utf8_bytes_needed = 0;\n      return decoderError(fatal);\n    }\n\n    // 2. If byte is end-of-stream, return finished.\n    if (bite === end_of_stream)\n      return finished;\n\n    // 3. If utf-8 bytes needed is 0, based on byte:\n    if (utf8_bytes_needed === 0) {\n\n      // 0x00 to 0x7F\n      if (inRange(bite, 0x00, 0x7F)) {\n        // Return a code point whose value is byte.\n        return bite;\n      }\n\n      // 0xC2 to 0xDF\n      if (inRange(bite, 0xC2, 0xDF)) {\n        // Set utf-8 bytes needed to 1 and utf-8 code point to byte\n        // − 0xC0.\n        utf8_bytes_needed = 1;\n        utf8_code_point = bite - 0xC0;\n      }\n\n      // 0xE0 to 0xEF\n      else if (inRange(bite, 0xE0, 0xEF)) {\n        // 1. If byte is 0xE0, set utf-8 lower boundary to 0xA0.\n        if (bite === 0xE0)\n          utf8_lower_boundary = 0xA0;\n        // 2. If byte is 0xED, set utf-8 upper boundary to 0x9F.\n        if (bite === 0xED)\n          utf8_upper_boundary = 0x9F;\n        // 3. Set utf-8 bytes needed to 2 and utf-8 code point to\n        // byte − 0xE0.\n        utf8_bytes_needed = 2;\n        utf8_code_point = bite - 0xE0;\n      }\n\n      // 0xF0 to 0xF4\n      else if (inRange(bite, 0xF0, 0xF4)) {\n        // 1. If byte is 0xF0, set utf-8 lower boundary to 0x90.\n        if (bite === 0xF0)\n          utf8_lower_boundary = 0x90;\n        // 2. If byte is 0xF4, set utf-8 upper boundary to 0x8F.\n        if (bite === 0xF4)\n          utf8_upper_boundary = 0x8F;\n        // 3. Set utf-8 bytes needed to 3 and utf-8 code point to\n        // byte − 0xF0.\n        utf8_bytes_needed = 3;\n        utf8_code_point = bite - 0xF0;\n      }\n\n      // Otherwise\n      else {\n        // Return error.\n        return decoderError(fatal);\n      }\n\n      // Then (byte is in the range 0xC2 to 0xF4) set utf-8 code\n      // point to utf-8 code point << (6 × utf-8 bytes needed) and\n      // return continue.\n      utf8_code_point = utf8_code_point << (6 * utf8_bytes_needed);\n      return null;\n    }\n\n    // 4. If byte is not in the range utf-8 lower boundary to utf-8\n    // upper boundary, run these substeps:\n    if (!inRange(bite, utf8_lower_boundary, utf8_upper_boundary)) {\n\n      // 1. Set utf-8 code point, utf-8 bytes needed, and utf-8\n      // bytes seen to 0, set utf-8 lower boundary to 0x80, and set\n      // utf-8 upper boundary to 0xBF.\n      utf8_code_point = utf8_bytes_needed = utf8_bytes_seen = 0;\n      utf8_lower_boundary = 0x80;\n      utf8_upper_boundary = 0xBF;\n\n      // 2. Prepend byte to stream.\n      stream.prepend(bite);\n\n      // 3. Return error.\n      return decoderError(fatal);\n    }\n\n    // 5. Set utf-8 lower boundary to 0x80 and utf-8 upper boundary\n    // to 0xBF.\n    utf8_lower_boundary = 0x80;\n    utf8_upper_boundary = 0xBF;\n\n    // 6. Increase utf-8 bytes seen by one and set utf-8 code point\n    // to utf-8 code point + (byte − 0x80) << (6 × (utf-8 bytes\n    // needed − utf-8 bytes seen)).\n    utf8_bytes_seen += 1;\n    utf8_code_point += (bite - 0x80) << (6 * (utf8_bytes_needed - utf8_bytes_seen));\n\n    // 7. If utf-8 bytes seen is not equal to utf-8 bytes needed,\n    // continue.\n    if (utf8_bytes_seen !== utf8_bytes_needed)\n      return null;\n\n    // 8. Let code point be utf-8 code point.\n    var code_point = utf8_code_point;\n\n    // 9. Set utf-8 code point, utf-8 bytes needed, and utf-8 bytes\n    // seen to 0.\n    utf8_code_point = utf8_bytes_needed = utf8_bytes_seen = 0;\n\n    // 10. Return a code point whose value is code point.\n    return code_point;\n  };\n}\n\n/**\n * @constructor\n * @implements {Encoder}\n * @param {{fatal: boolean}} options\n */\nfunction UTF8Encoder(options) {\n  var fatal = options.fatal;\n  /**\n   * @param {Stream} stream Input stream.\n   * @param {number} code_point Next code point read from the stream.\n   * @return {(number|!Array.<number>)} Byte(s) to emit.\n   */\n  this.handler = function(stream, code_point) {\n    // 1. If code point is end-of-stream, return finished.\n    if (code_point === end_of_stream)\n      return finished;\n\n    // 2. If code point is in the range U+0000 to U+007F, return a\n    // byte whose value is code point.\n    if (inRange(code_point, 0x0000, 0x007f))\n      return code_point;\n\n    // 3. Set count and offset based on the range code point is in:\n    var count, offset;\n    // U+0080 to U+07FF:    1 and 0xC0\n    if (inRange(code_point, 0x0080, 0x07FF)) {\n      count = 1;\n      offset = 0xC0;\n    }\n    // U+0800 to U+FFFF:    2 and 0xE0\n    else if (inRange(code_point, 0x0800, 0xFFFF)) {\n      count = 2;\n      offset = 0xE0;\n    }\n    // U+10000 to U+10FFFF: 3 and 0xF0\n    else if (inRange(code_point, 0x10000, 0x10FFFF)) {\n      count = 3;\n      offset = 0xF0;\n    }\n\n    // 4.Let bytes be a byte sequence whose first byte is (code\n    // point >> (6 × count)) + offset.\n    var bytes = [(code_point >> (6 * count)) + offset];\n\n    // 5. Run these substeps while count is greater than 0:\n    while (count > 0) {\n\n      // 1. Set temp to code point >> (6 × (count − 1)).\n      var temp = code_point >> (6 * (count - 1));\n\n      // 2. Append to bytes 0x80 | (temp & 0x3F).\n      bytes.push(0x80 | (temp & 0x3F));\n\n      // 3. Decrease count by one.\n      count -= 1;\n    }\n\n    // 6. Return bytes bytes, in order.\n    return bytes;\n  };\n}\n\nexports.TextEncoder = TextEncoder;\nexports.TextDecoder = TextDecoder;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/text-encoding-utf-8/lib/encoding.cjs.js\n// module id = 477\n// module chunks = 0 3","/*\nCopyright 2017 Vector Creations Ltd\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport React from 'react';\n\nimport * as Matrix from 'matrix-js-sdk';\nimport * as MegolmExportEncryption from '../../../utils/MegolmExportEncryption';\nimport sdk from '../../../index';\nimport { _t } from '../../../languageHandler';\n\nfunction readFileAsArrayBuffer(file) {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = (e) => {\n            resolve(e.target.result);\n        };\n        reader.onerror = reject;\n\n        reader.readAsArrayBuffer(file);\n    });\n}\n\nconst PHASE_EDIT = 1;\nconst PHASE_IMPORTING = 2;\n\nexport default React.createClass({\n    displayName: 'ImportE2eKeysDialog',\n\n    propTypes: {\n        matrixClient: React.PropTypes.instanceOf(Matrix.MatrixClient).isRequired,\n        onFinished: React.PropTypes.func.isRequired,\n    },\n\n    getInitialState: function() {\n        return {\n            enableSubmit: false,\n            phase: PHASE_EDIT,\n            errStr: null,\n        };\n    },\n\n    componentWillMount: function() {\n        this._unmounted = false;\n    },\n\n    componentWillUnmount: function() {\n        this._unmounted = true;\n    },\n\n    _onFormChange: function(ev) {\n        const files = this.refs.file.files || [];\n        this.setState({\n            enableSubmit: (this.refs.passphrase.value !== \"\" && files.length > 0),\n        });\n    },\n\n    _onFormSubmit: function(ev) {\n        ev.preventDefault();\n        this._startImport(this.refs.file.files[0], this.refs.passphrase.value);\n        return false;\n    },\n\n    _startImport: function(file, passphrase) {\n        this.setState({\n            errStr: null,\n            phase: PHASE_IMPORTING,\n        });\n\n        return readFileAsArrayBuffer(file).then((arrayBuffer) => {\n            return MegolmExportEncryption.decryptMegolmKeyFile(\n                arrayBuffer, passphrase,\n            );\n        }).then((keys) => {\n            return this.props.matrixClient.importRoomKeys(JSON.parse(keys));\n        }).then(() => {\n            // TODO: it would probably be nice to give some feedback about what we've imported here.\n            this.props.onFinished(true);\n        }).catch((e) => {\n            console.error(\"Error importing e2e keys:\", e);\n            if (this._unmounted) {\n                return;\n            }\n            const msg = e.friendlyText || _t('Unknown error');\n            this.setState({\n                errStr: msg,\n                phase: PHASE_EDIT,\n            });\n        });\n    },\n\n    _onCancelClick: function(ev) {\n        ev.preventDefault();\n        this.props.onFinished(false);\n        return false;\n    },\n\n    render: function() {\n        const BaseDialog = sdk.getComponent('views.dialogs.BaseDialog');\n\n        const disableForm = (this.state.phase !== PHASE_EDIT);\n\n        return (\n            <BaseDialog className='mx_importE2eKeysDialog'\n                onFinished={this.props.onFinished}\n                title={_t(\"Import room keys\")}\n            >\n                <form onSubmit={this._onFormSubmit}>\n                    <div className=\"mx_Dialog_content\">\n                        <p>\n                            { _t(\n                                'This process allows you to import encryption keys ' +\n                                'that you had previously exported from another Matrix ' +\n                                'client. You will then be able to decrypt any ' +\n                                'messages that the other client could decrypt.',\n                            ) }\n                        </p>\n                        <p>\n                            { _t(\n                                'The export file will be protected with a passphrase. ' +\n                                'You should enter the passphrase here, to decrypt the file.',\n                            ) }\n                        </p>\n                        <div className='error'>\n                            {this.state.errStr}\n                        </div>\n                        <div className='mx_E2eKeysDialog_inputTable'>\n                            <div className='mx_E2eKeysDialog_inputRow'>\n                               <div className='mx_E2eKeysDialog_inputLabel'>\n                                   <label htmlFor='importFile'>\n                                       {_t(\"File to import\")}\n                                   </label>\n                               </div>\n                               <div className='mx_E2eKeysDialog_inputCell'>\n                                   <input ref='file' id='importFile' type='file'\n                                       autoFocus={true}\n                                       onChange={this._onFormChange}\n                                       disabled={disableForm} />\n                               </div>\n                            </div>\n                            <div className='mx_E2eKeysDialog_inputRow'>\n                               <div className='mx_E2eKeysDialog_inputLabel'>\n                                   <label htmlFor='passphrase'>\n                                       {_t(\"Enter passphrase\")}\n                                   </label>\n                               </div>\n                               <div className='mx_E2eKeysDialog_inputCell'>\n                                   <input ref='passphrase' id='passphrase'\n                                       size='64' type='password'\n                                       onChange={this._onFormChange}\n                                       disabled={disableForm}/>\n                               </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div className='mx_Dialog_buttons'>\n                        <input className='mx_Dialog_primary' type='submit' value={_t('Import')}\n                            disabled={!this.state.enableSubmit || disableForm}\n                        />\n                        <button onClick={this._onCancelClick} disabled={disableForm}>\n                            {_t(\"Cancel\")}\n                        </button>\n                    </div>\n                </form>\n            </BaseDialog>\n        );\n    },\n});\n\n\n\n// WEBPACK FOOTER //\n// ../../../../src/async-components/views/dialogs/ImportE2eKeysDialog.js","/*\nCopyright 2017 Vector Creations Ltd\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n\"use strict\";\n\n// polyfill textencoder if necessary\nimport * as TextEncodingUtf8 from 'text-encoding-utf-8';\nlet TextEncoder = window.TextEncoder;\nif (!TextEncoder) {\n    TextEncoder = TextEncodingUtf8.TextEncoder;\n}\nlet TextDecoder = window.TextDecoder;\nif (!TextDecoder) {\n    TextDecoder = TextEncodingUtf8.TextDecoder;\n}\n\nimport { _t } from '../languageHandler';\n\n\nconst subtleCrypto = window.crypto.subtle || window.crypto.webkitSubtle;\n\n/**\n * Make an Error object which has a friendlyText property which is already\n * translated and suitable for showing to the user.\n *\n * @param {string} msg   message for the exception\n * @param {string} friendlyText\n * @returns {Error}\n */\nfunction friendlyError(msg, friendlyText) {\n    const e = new Error(msg);\n    e.friendlyText = friendlyText;\n    return e;\n}\n\nfunction cryptoFailMsg() {\n    return _t('Your browser does not support the required cryptography extensions');\n}\n\n/**\n * Decrypt a megolm key file\n *\n * @param {ArrayBuffer} data file to decrypt\n * @param {String} password\n * @return {Promise<String>} promise for decrypted output\n *\n *\n */\nexport async function decryptMegolmKeyFile(data, password) {\n    const body = unpackMegolmKeyFile(data);\n\n    // check we have a version byte\n    if (body.length < 1) {\n        throw friendlyError('Invalid file: too short',\n            _t('Not a valid Riot keyfile'));\n    }\n\n    const version = body[0];\n    if (version !== 1) {\n        throw friendlyError('Unsupported version',\n            _t('Not a valid Riot keyfile'));\n    }\n\n    const ciphertextLength = body.length-(1+16+16+4+32);\n    if (ciphertextLength < 0) {\n        throw friendlyError('Invalid file: too short',\n            _t('Not a valid Riot keyfile'));\n    }\n\n    const salt = body.subarray(1, 1+16);\n    const iv = body.subarray(17, 17+16);\n    const iterations = body[33] << 24 | body[34] << 16 | body[35] << 8 | body[36];\n    const ciphertext = body.subarray(37, 37+ciphertextLength);\n    const hmac = body.subarray(-32);\n\n    const [aesKey, hmacKey] = await deriveKeys(salt, iterations, password);\n    const toVerify = body.subarray(0, -32);\n\n    let isValid;\n    try {\n        isValid = await subtleCrypto.verify(\n            {name: 'HMAC'},\n            hmacKey,\n            hmac,\n            toVerify,\n        );\n    } catch (e) {\n        throw friendlyError('subtleCrypto.verify failed: ' + e, cryptoFailMsg());\n    }\n    if (!isValid) {\n        throw friendlyError('hmac mismatch',\n            _t('Authentication check failed: incorrect password?'));\n    }\n\n    let plaintext;\n    try {\n        plaintext = await subtleCrypto.decrypt(\n            {\n                name: \"AES-CTR\",\n                counter: iv,\n                length: 64,\n            },\n            aesKey,\n            ciphertext,\n        );\n    } catch(e) {\n        throw friendlyError('subtleCrypto.decrypt failed: ' + e, cryptoFailMsg());\n    }\n\n    return new TextDecoder().decode(new Uint8Array(plaintext));\n}\n\n\n/**\n * Encrypt a megolm key file\n *\n * @param {String} data\n * @param {String} password\n * @param {Object=} options\n * @param {Nunber=} options.kdf_rounds Number of iterations to perform of the\n *    key-derivation function.\n * @return {Promise<ArrayBuffer>} promise for encrypted output\n */\nexport async function encryptMegolmKeyFile(data, password, options) {\n    options = options || {};\n    const kdfRounds = options.kdf_rounds || 500000;\n\n    const salt = new Uint8Array(16);\n    window.crypto.getRandomValues(salt);\n\n    const iv = new Uint8Array(16);\n    window.crypto.getRandomValues(iv);\n\n    // clear bit 63 of the IV to stop us hitting the 64-bit counter boundary\n    // (which would mean we wouldn't be able to decrypt on Android). The loss\n    // of a single bit of iv is a price we have to pay.\n    iv[9] &= 0x7f;\n\n    const [aesKey, hmacKey] = await deriveKeys(salt, kdfRounds, password);\n    const encodedData = new TextEncoder().encode(data);\n\n    let ciphertext;\n    try {\n        ciphertext = await subtleCrypto.encrypt(\n            {\n                name: \"AES-CTR\",\n                counter: iv,\n                length: 64,\n            },\n            aesKey,\n            encodedData,\n        );\n    } catch (e) {\n        throw friendlyError('subtleCrypto.encrypt failed: ' + e, cryptoFailMsg());\n    }\n\n    const cipherArray = new Uint8Array(ciphertext);\n    const bodyLength = (1+salt.length+iv.length+4+cipherArray.length+32);\n    const resultBuffer = new Uint8Array(bodyLength);\n    let idx = 0;\n    resultBuffer[idx++] = 1; // version\n    resultBuffer.set(salt, idx); idx += salt.length;\n    resultBuffer.set(iv, idx); idx += iv.length;\n    resultBuffer[idx++] = kdfRounds >> 24;\n    resultBuffer[idx++] = (kdfRounds >> 16) & 0xff;\n    resultBuffer[idx++] = (kdfRounds >> 8) & 0xff;\n    resultBuffer[idx++] = kdfRounds & 0xff;\n    resultBuffer.set(cipherArray, idx); idx += cipherArray.length;\n\n    const toSign = resultBuffer.subarray(0, idx);\n\n    let hmac;\n    try {\n        hmac = await subtleCrypto.sign(\n            {name: 'HMAC'},\n            hmacKey,\n            toSign,\n        );\n    } catch (e) {\n        throw friendlyError('subtleCrypto.sign failed: ' + e, cryptoFailMsg());\n    }\n\n\n    const hmacArray = new Uint8Array(hmac);\n    resultBuffer.set(hmacArray, idx);\n    return packMegolmKeyFile(resultBuffer);\n}\n\n/**\n * Derive the AES and HMAC-SHA-256 keys for the file\n *\n * @param {Unit8Array} salt  salt for pbkdf\n * @param {Number} iterations number of pbkdf iterations\n * @param {String} password  password\n * @return {Promise<[CryptoKey, CryptoKey]>} promise for [aes key, hmac key]\n */\nasync function deriveKeys(salt, iterations, password) {\n    const start = new Date();\n\n    let key;\n    try {\n        key = await subtleCrypto.importKey(\n            'raw',\n            new TextEncoder().encode(password),\n            {name: 'PBKDF2'},\n            false,\n            ['deriveBits'],\n        );\n    } catch (e) {\n        throw friendlyError('subtleCrypto.importKey failed: ' + e, cryptoFailMsg());\n    }\n\n    let keybits;\n    try {\n        keybits = await subtleCrypto.deriveBits(\n            {\n                name: 'PBKDF2',\n                salt: salt,\n                iterations: iterations,\n                hash: 'SHA-512',\n            },\n            key,\n            512,\n        );\n    } catch (e) {\n        throw friendlyError('subtleCrypto.deriveBits failed: ' + e, cryptoFailMsg());\n    }\n\n    const now = new Date();\n    console.log(\"E2e import/export: deriveKeys took \" + (now - start) + \"ms\");\n\n    const aesKey = keybits.slice(0, 32);\n    const hmacKey = keybits.slice(32);\n\n    const aesProm = subtleCrypto.importKey(\n        'raw',\n        aesKey,\n        {name: 'AES-CTR'},\n        false,\n        ['encrypt', 'decrypt'],\n    ).catch((e) => {\n        throw friendlyError('subtleCrypto.importKey failed for AES key: ' + e, cryptoFailMsg());\n    });\n\n    const hmacProm = subtleCrypto.importKey(\n        'raw',\n        hmacKey,\n        {\n            name: 'HMAC',\n            hash: {name: 'SHA-256'},\n        },\n        false,\n        ['sign', 'verify'],\n    ).catch((e) => {\n        throw friendlyError('subtleCrypto.importKey failed for HMAC key: ' + e, cryptoFailMsg());\n    });\n\n    return await Promise.all([aesProm, hmacProm]);\n}\n\nconst HEADER_LINE = '-----BEGIN MEGOLM SESSION DATA-----';\nconst TRAILER_LINE = '-----END MEGOLM SESSION DATA-----';\n\n/**\n * Unbase64 an ascii-armoured megolm key file\n *\n * Strips the header and trailer lines, and unbase64s the content\n *\n * @param {ArrayBuffer} data  input file\n * @return {Uint8Array} unbase64ed content\n */\nfunction unpackMegolmKeyFile(data) {\n    // parse the file as a great big String. This should be safe, because there\n    // should be no non-ASCII characters, and it means that we can do string\n    // comparisons to find the header and footer, and feed it into window.atob.\n    const fileStr = new TextDecoder().decode(new Uint8Array(data));\n\n    // look for the start line\n    let lineStart = 0;\n    while (1) {\n        const lineEnd = fileStr.indexOf('\\n', lineStart);\n        if (lineEnd < 0) {\n            throw new Error('Header line not found');\n        }\n        const line = fileStr.slice(lineStart, lineEnd).trim();\n\n        // start the next line after the newline\n        lineStart = lineEnd+1;\n\n        if (line === HEADER_LINE) {\n            break;\n        }\n    }\n\n    const dataStart = lineStart;\n\n    // look for the end line\n    while (1) {\n        const lineEnd = fileStr.indexOf('\\n', lineStart);\n        const line = fileStr.slice(lineStart, lineEnd < 0 ? undefined : lineEnd)\n              .trim();\n        if (line === TRAILER_LINE) {\n            break;\n        }\n\n        if (lineEnd < 0) {\n            throw new Error('Trailer line not found');\n        }\n\n        // start the next line after the newline\n        lineStart = lineEnd+1;\n    }\n\n    const dataEnd = lineStart;\n    return decodeBase64(fileStr.slice(dataStart, dataEnd));\n}\n\n/**\n * ascii-armour a  megolm key file\n *\n * base64s the content, and adds header and trailer lines\n *\n * @param {Uint8Array} data  raw data\n * @return {ArrayBuffer} formatted file\n */\nfunction packMegolmKeyFile(data) {\n    // we split into lines before base64ing, because encodeBase64 doesn't deal\n    // terribly well with large arrays.\n    const LINE_LENGTH = (72 * 4 / 3);\n    const nLines = Math.ceil(data.length / LINE_LENGTH);\n    const lines = new Array(nLines + 3);\n    lines[0] = HEADER_LINE;\n    let o = 0;\n    let i;\n    for (i = 1; i <= nLines; i++) {\n        lines[i] = encodeBase64(data.subarray(o, o+LINE_LENGTH));\n        o += LINE_LENGTH;\n    }\n    lines[i++] = TRAILER_LINE;\n    lines[i] = '';\n    return (new TextEncoder().encode(lines.join('\\n'))).buffer;\n}\n\n/**\n * Encode a typed array of uint8 as base64.\n * @param {Uint8Array} uint8Array The data to encode.\n * @return {string} The base64.\n */\nfunction encodeBase64(uint8Array) {\n    // Misinterpt the Uint8Array as Latin-1.\n    // window.btoa expects a unicode string with codepoints in the range 0-255.\n    const latin1String = String.fromCharCode.apply(null, uint8Array);\n    // Use the builtin base64 encoder.\n    return window.btoa(latin1String);\n}\n\n/**\n * Decode a base64 string to a typed array of uint8.\n * @param {string} base64 The base64 to decode.\n * @return {Uint8Array} The decoded data.\n */\nfunction decodeBase64(base64) {\n    // window.atob returns a unicode string with codepoints in the range 0-255.\n    const latin1String = window.atob(base64);\n    // Encode the string as a Uint8Array\n    const uint8Array = new Uint8Array(latin1String.length);\n    for (let i = 0; i < latin1String.length; i++) {\n        uint8Array[i] = latin1String.charCodeAt(i);\n    }\n    return uint8Array;\n}\n\n\n\n// WEBPACK FOOTER //\n// ../../src/utils/MegolmExportEncryption.js","/* FileSaver.js\n * A saveAs() FileSaver implementation.\n * 1.3.2\n * 2016-06-16 18:25:19\n *\n * By Eli Grey, http://eligrey.com\n * License: MIT\n *   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md\n */\n\n/*global self */\n/*jslint bitwise: true, indent: 4, laxbreak: true, laxcomma: true, smarttabs: true, plusplus: true */\n\n/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */\n\nvar saveAs = saveAs || (function(view) {\n\t\"use strict\";\n\t// IE <10 is explicitly unsupported\n\tif (typeof view === \"undefined\" || typeof navigator !== \"undefined\" && /MSIE [1-9]\\./.test(navigator.userAgent)) {\n\t\treturn;\n\t}\n\tvar\n\t\t  doc = view.document\n\t\t  // only get URL when necessary in case Blob.js hasn't overridden it yet\n\t\t, get_URL = function() {\n\t\t\treturn view.URL || view.webkitURL || view;\n\t\t}\n\t\t, save_link = doc.createElementNS(\"http://www.w3.org/1999/xhtml\", \"a\")\n\t\t, can_use_save_link = \"download\" in save_link\n\t\t, click = function(node) {\n\t\t\tvar event = new MouseEvent(\"click\");\n\t\t\tnode.dispatchEvent(event);\n\t\t}\n\t\t, is_safari = /constructor/i.test(view.HTMLElement) || view.safari\n\t\t, is_chrome_ios =/CriOS\\/[\\d]+/.test(navigator.userAgent)\n\t\t, throw_outside = function(ex) {\n\t\t\t(view.setImmediate || view.setTimeout)(function() {\n\t\t\t\tthrow ex;\n\t\t\t}, 0);\n\t\t}\n\t\t, force_saveable_type = \"application/octet-stream\"\n\t\t// the Blob API is fundamentally broken as there is no \"downloadfinished\" event to subscribe to\n\t\t, arbitrary_revoke_timeout = 1000 * 40 // in ms\n\t\t, revoke = function(file) {\n\t\t\tvar revoker = function() {\n\t\t\t\tif (typeof file === \"string\") { // file is an object URL\n\t\t\t\t\tget_URL().revokeObjectURL(file);\n\t\t\t\t} else { // file is a File\n\t\t\t\t\tfile.remove();\n\t\t\t\t}\n\t\t\t};\n\t\t\tsetTimeout(revoker, arbitrary_revoke_timeout);\n\t\t}\n\t\t, dispatch = function(filesaver, event_types, event) {\n\t\t\tevent_types = [].concat(event_types);\n\t\t\tvar i = event_types.length;\n\t\t\twhile (i--) {\n\t\t\t\tvar listener = filesaver[\"on\" + event_types[i]];\n\t\t\t\tif (typeof listener === \"function\") {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlistener.call(filesaver, event || filesaver);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\tthrow_outside(ex);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t, auto_bom = function(blob) {\n\t\t\t// prepend BOM for UTF-8 XML and text/* types (including HTML)\n\t\t\t// note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n\t\t\tif (/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n\t\t\t\treturn new Blob([String.fromCharCode(0xFEFF), blob], {type: blob.type});\n\t\t\t}\n\t\t\treturn blob;\n\t\t}\n\t\t, FileSaver = function(blob, name, no_auto_bom) {\n\t\t\tif (!no_auto_bom) {\n\t\t\t\tblob = auto_bom(blob);\n\t\t\t}\n\t\t\t// First try a.download, then web filesystem, then object URLs\n\t\t\tvar\n\t\t\t\t  filesaver = this\n\t\t\t\t, type = blob.type\n\t\t\t\t, force = type === force_saveable_type\n\t\t\t\t, object_url\n\t\t\t\t, dispatch_all = function() {\n\t\t\t\t\tdispatch(filesaver, \"writestart progress write writeend\".split(\" \"));\n\t\t\t\t}\n\t\t\t\t// on any filesys errors revert to saving with object URLs\n\t\t\t\t, fs_error = function() {\n\t\t\t\t\tif ((is_chrome_ios || (force && is_safari)) && view.FileReader) {\n\t\t\t\t\t\t// Safari doesn't allow downloading of blob urls\n\t\t\t\t\t\tvar reader = new FileReader();\n\t\t\t\t\t\treader.onloadend = function() {\n\t\t\t\t\t\t\tvar url = is_chrome_ios ? reader.result : reader.result.replace(/^data:[^;]*;/, 'data:attachment/file;');\n\t\t\t\t\t\t\tvar popup = view.open(url, '_blank');\n\t\t\t\t\t\t\tif(!popup) view.location.href = url;\n\t\t\t\t\t\t\turl=undefined; // release reference before dispatching\n\t\t\t\t\t\t\tfilesaver.readyState = filesaver.DONE;\n\t\t\t\t\t\t\tdispatch_all();\n\t\t\t\t\t\t};\n\t\t\t\t\t\treader.readAsDataURL(blob);\n\t\t\t\t\t\tfilesaver.readyState = filesaver.INIT;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// don't create more object URLs than needed\n\t\t\t\t\tif (!object_url) {\n\t\t\t\t\t\tobject_url = get_URL().createObjectURL(blob);\n\t\t\t\t\t}\n\t\t\t\t\tif (force) {\n\t\t\t\t\t\tview.location.href = object_url;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar opened = view.open(object_url, \"_blank\");\n\t\t\t\t\t\tif (!opened) {\n\t\t\t\t\t\t\t// Apple does not allow window.open, see https://developer.apple.com/library/safari/documentation/Tools/Conceptual/SafariExtensionGuide/WorkingwithWindowsandTabs/WorkingwithWindowsandTabs.html\n\t\t\t\t\t\t\tview.location.href = object_url;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfilesaver.readyState = filesaver.DONE;\n\t\t\t\t\tdispatch_all();\n\t\t\t\t\trevoke(object_url);\n\t\t\t\t}\n\t\t\t;\n\t\t\tfilesaver.readyState = filesaver.INIT;\n\n\t\t\tif (can_use_save_link) {\n\t\t\t\tobject_url = get_URL().createObjectURL(blob);\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tsave_link.href = object_url;\n\t\t\t\t\tsave_link.download = name;\n\t\t\t\t\tclick(save_link);\n\t\t\t\t\tdispatch_all();\n\t\t\t\t\trevoke(object_url);\n\t\t\t\t\tfilesaver.readyState = filesaver.DONE;\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfs_error();\n\t\t}\n\t\t, FS_proto = FileSaver.prototype\n\t\t, saveAs = function(blob, name, no_auto_bom) {\n\t\t\treturn new FileSaver(blob, name || blob.name || \"download\", no_auto_bom);\n\t\t}\n\t;\n\t// IE 10+ (native saveAs)\n\tif (typeof navigator !== \"undefined\" && navigator.msSaveOrOpenBlob) {\n\t\treturn function(blob, name, no_auto_bom) {\n\t\t\tname = name || blob.name || \"download\";\n\n\t\t\tif (!no_auto_bom) {\n\t\t\t\tblob = auto_bom(blob);\n\t\t\t}\n\t\t\treturn navigator.msSaveOrOpenBlob(blob, name);\n\t\t};\n\t}\n\n\tFS_proto.abort = function(){};\n\tFS_proto.readyState = FS_proto.INIT = 0;\n\tFS_proto.WRITING = 1;\n\tFS_proto.DONE = 2;\n\n\tFS_proto.error =\n\tFS_proto.onwritestart =\n\tFS_proto.onprogress =\n\tFS_proto.onwrite =\n\tFS_proto.onabort =\n\tFS_proto.onerror =\n\tFS_proto.onwriteend =\n\t\tnull;\n\n\treturn saveAs;\n}(\n\t   typeof self !== \"undefined\" && self\n\t|| typeof window !== \"undefined\" && window\n\t|| this.content\n));\n// `self` is undefined in Firefox for Android content script context\n// while `this` is nsIContentFrameMessageManager\n// with an attribute `content` that corresponds to the window\n\nif (typeof module !== \"undefined\" && module.exports) {\n  module.exports.saveAs = saveAs;\n} else if ((typeof define !== \"undefined\" && define !== null) && (define.amd !== null)) {\n  define(\"FileSaver.js\", function() {\n    return saveAs;\n  });\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/file-saver/FileSaver.js\n// module id = 1173\n// module chunks = 0"],"sourceRoot":""}